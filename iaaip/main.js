!function(e){var a={};function t(i){if(a[i])return a[i].exports;var o=a[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=a,t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var o in e)t.d(i,o,function(a){return e[a]}.bind(null,o));return i},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=35)}([function(e){e.exports=JSON.parse('{"provider":"HMCTS","providerLongName":"HM Courts and Tribunals Service","pageTitle":"Immigration & Asylum","serviceName":"Appeal an immigration or asylum decision","serviceUrl":"#","errorTitlePrefix":"Error:","phaseBanner":{"version":"Beta","text":"This is a new service – your <a class=\'govuk-link\' href=\'#\' target=\'_blank\'>feedback</a> will help us to improve it. (opens in a new window)"},"common":{"buttons":{"saveAndContinue":"Save and continue","continue":"Continue","saveForLater":"Save for later","uploadFile":"Upload file","send":"Send"},"requirements":{"heading":"You will need to:"},"links":{"change":"Change","delete":"Delete"},"cya":{"questionRowTitle":"Question","answerRowTitle":"Answer","supportingEvidenceRowTitle":"Supporting evidence"}},"pages":{"index":{"title":"Start your appeal"},"start":{"title":"Home","header":"Appeal an immigration or asylum decision","description":"We need to ask you a few questions to start your appeal.","startText":"Start now","requirements":["create an account if you haven\'t already got one","have your Home Office decision letter with you"]},"taskList":{"title":"Tell us about your appeal","header":"Tell us about your appeal","sections":{"yourDetails":"Your details","appealDetails":"Appeal details","checkAndSend":"Check and send"},"homeOfficeDetails":{"id":"homeOfficeDetailsLink","title":"Your Home Office details","path":"homeOffice.details"},"personalDetails":{"id":"personalDetailsLink","title":"Your personal details","path":"personalDetails.name"},"contactDetails":{"id":"contactDetailsLink","title":"Your contact details","path":"contactDetails"},"typeOfAppeal":{"id":"typeOfAppealLink","title":"Type of appeal","path":"typeOfAppeal"},"checkAndSend":{"id":"checkAndSendLink","title":"Check and send your appeal details","path":"checkAndSend"}},"contactDetails":{"header":"How do you want us to contact you?","hint":"Select at least one of the option below","email":"Email","enterEmail":"Enter email address","mobile":"Enter mobile phone number","textMessage":"Text message"},"appealType":{"header":"What is your appeal type?","pageHint":"Select one appeal type. If you think more than one applies to your appeal, you will have the chance to tell us about that later.","exampleSummaryText":"Reasons to select "},"DOB":{"title":"What is your date of birth? ","hint":"For example, 31 3 1980"},"nationality":{"title":"What is your nationality?","stateless":"I am stateless (A stateless person is not a citizen of any country).","defaultNationality":"Please select a nationality"},"checkYourAnswers":{"title":"Check your answer","header":"Check your answer","statement":"Statement of truth","agreement":"I believe the information I have given is true","rowTitles":{"textMessage":"Text message","mobilePhone":"Enter mobile phone number","email":"Email","emailAddress":"Enter email address","homeOfficeRefNumber":"Home Office reference number","dateLetterSent":"Date letter sent","name":"Name","dob":"Date of birth","nationality":"Nationality","contactDetails":"Contact details","addressDetails":"Address","appealType":"Appeal type","appealLate":"Reason for late appeal","supportingEvidence":"<p><span  class=\'govuk-body govuk-!-font-weight-bold\'> Supporting evidence</span> </p>"},"supportingEvidence":"<a href=\'{{ evidenceUrl }}\' class=\'govuk-link\'>{{ evidence }}</a>"},"name":{"title":"What is your name?","givenNames":"Given names","familyName":"Family name"},"enterPostcode":{"heading":"What is your address?","title":"What is your address?","hint":"Enter a UK postcode","findAddress":"Find address","manualAddressLink":"I want to enter my address manually"},"enterAddress":{"heading":"What is your address?","title":"What is your address?","change":"Change","inputs":{"building":"Building and street","buildingAndStreet":"Building and street <span class=\\"govuk-visually-hidden\\">line 1 of 2</span>","buildingAndStreet2":"<span class=\\"govuk-visually-hidden\\">Building and street line 2 of 2</span>","town":"Town or city","country":"Country","county":"County","postcode":"Postcode"}},"postcodeLookup":{"heading":"What is your address?","title":"What is your address?","postcodeHeading":"Postcode","select":"Select an address","cantFind":"I cant find my address in the list","addressFound":"1 address found","addressesFound":"addresses found"},"homeOfficePage":{"title":"What is your Home Office reference number?","description":"You can find this on the top right-hand side of the decision letter.","refImageAltText":"Image of Home Office decision letter","homeOfficeReferenceNumberLabel":"Home Office reference number"},"homeOfficeLetterSent":{"title":"What date was the letter sent?","description":"You can usually find this stamped on the envelope of the decision letter. If you don\'t have the envelope, you can enter the date on the first page of the decision letter.","dateTitle":"Date letter sent","dateHint":"For example, 31 3 2019","letterSentImageAltText":"Image of Home Office decision letter"},"homeOfficeAppealLate":{"title":"Your appeal is late","appealLateLabel":"Why is your appeal late?","description":"Appeals should be made within 14 days of the date the decision letter was sent. <br />You may still be able to appeal. Please tell us why your appeal is late, and provide supporting evidence if you have it.","provideEvidenceTitle":"Provide supporting evidence","provideEvidenceDescription":"You can upload evidence to support your answer such as letters, photos and documents. If you are taking a picture of a letter, place it on a flat surface and take the picture from above.","fileUploadTitle":"Upload a file","uploadedFileTitle":"Uploaded file"},"successPage":{"title":"Your appeal details have been sent","seeProgress":"See your appeal progress","whatHappensNext":"What happens next","info":"You will receive a notification to confirm that the Tribunal has received your appeal details","noResponse":"If you haven\'t heard from us by <strong>{{ date }}</strong> call <span  class=\'govuk-body govuk-!-font-weight-bold\'> 0300 123 1711</span>  or <a class=\\"govuk-link\\" href=\\"#\\">send us a message</a>","caseWorker":"A Tribunal Caseworker will contact you to by <strong>{{ date }}</strong> to tell you if you can continue with your appeal and what to do next","tribunalWorker":"A Tribunal Caseworker will contact you to by <strong>{{ date }}</strong> to tell you what to do next","thingsYouCanDo":"Things you can do now","readMore":"Read more about appealing an immigration or asylum decision","findOutMore":"Find organisations that can you with your appeal","outOfTime":{"panel":"Your late appeal details have been sent"},"inTime":{"panel":"Your appeal details has been sent"}},"reasonForAppeal":{"title":"Why do you think the Home Office decision is wrong?","heading":"Why do you think the Home Office decision is wrong?","usefulInfo":"It may be helpful to look at the <a class=\\"evidence-list__link\\" href=\'#\'>Home Office documents</a> (opens in a new window). They include your decision letter and other information about your case.","textTitle":"<span  class=\'govuk-body govuk-!-font-weight-bold\'> Tell us in your own words</span>  - you don\'t have to have perfect English.","howToAnswer":"How to answer this question","bulletOne":"Carefully read your Home Office decision letter","bulletTwo":"Try to understand the parts of your claim the Home Office disagrees with","bulletThree":"Respond to some or all the things the Home Office disagrees with","bulletFour":"Tell us about anything <span  class=\'govuk-body govuk-!-font-weight-bold\'> new</span>  that will affect your case since you made your claim","bulletFive":"Include supporting evidence where you can. <span  class=\'govuk-body govuk-!-font-weight-bold\'> You can do this on the next page</span> ","needHelp":"If you need help","bulletLink":"Find organisations that can help you with your appeal"},"reasonForAppealCYA":{"rowTitles":{"supportingEvidence":"<span  class=\'govuk-body govuk-!-font-weight-bold\'> Supporting evidence</span> "}},"caseBuildingSuccess":{"titleText":"Your answer has been sent","answer":"A Tribunal Caseworker will look at your answer","date":"The Tribunal Caseworker will contact you by <span  class=\'govuk-body govuk-!-font-weight-bold\'> {{ date }}</span>  to tell you what to do next","questions":"If you have any questions about the appeal process, call the Tribunal on <span  class=\'govuk-body govuk-!-font-weight-bold\'> 0300 123 1711</span>  or email <a class=\\"govuk-link govuk-link--no-visited-state\\" href=\\"#\\">customer.services@justice.gov.uk</a>"},"reasonsForAppealUploadQuestion":{"title":"Do you want to provide supporting evidence?","provideSupportingEvidenceQuestion":"Do you want to provide supporting evidence?"},"reasonsForAppealUpload":{"title":"Providing supporting evidence","reasonsForAppeal":"Reasons for appeal","uploadInfo":"You can upload evidence to support your answer such as letters, photos and documents. If you are taking a picture of a letter, place it on a flat surface and take the picture from above.","uploadFile":"<span  class=\'govuk-body govuk-!-font-weight-bold\'> Upload a file</span> ","findOutMore":"Find out more about the evidence to support your appeal","uploadFiles":"Uploaded files","noFiles":"No files uploaded","needMoreTime":"Need more time?","evidence":"If you want to provide evidence but don\'t have it right now, you can <a class=\\"govuk-link\\"href=\\"#\\"> ask for more time</a>"},"ineligiblePage":{"title":"You cannot currently use the new service","description":"Based on your answers you can\'t use the new service at the moment. However, you can still appeal the Home Office decision either online or using our paper form","optionsList":["<a href=\\"https://immigrationappealsonline.justice.gov.uk/IACFees/\\">Appeal online</a>","<a href=\\"https://www.gov.uk/government/publications/appeal-a-visa-or-immigration-decision-within-the-uk-form-iaft-5\\">Appeal by post or fax with form IAFT-5</a>"],"moreInfo":{"title":"More information","moreInfoList":["<a href=\\"https://www.gov.uk/immigration-asylum-tribunal\\">Find out more about appealing an immigration or asylum decision</a>"]}},"eligiblePage":{"title":"You can use the new service","heading":"You can use the new service","basedOnAnswers":"Based on your answers, you can use the new service to appeal an immigration or asylum decision.","askQuestions":"We will now ask you a few questions so you can send us your appeal details. You will first need to create an account, or sign in if you already have one.","questions":"If you have any questions about the appeal process, call the Tribunal on <span  class=\'govuk-body govuk-!-font-weight-bold\'> 0300 123 1711</span>  or <a class=\\"govuk-link govuk-link--no-visited-state\\" href=\'#\'>send us a message</a>"},"overviewPage":{"title":"Your appeal overview","contactUs":"Contact us for help","askAQuestion":"Ask a question or get help in your language","telephone":"Telephone:","telephoneNumber":"0300 123 1171","email":"Email:","emailLink":"customer.service@justice.gov.uk","time":"Monday to Friday, 8:30am to 5pm","charges":"Find out about call charges","newWindow":"(opens in a new window)","doThisNext":{"toDo":"Do this next","nothingToDo":"Nothing to do next","appealStarted":{"fewQuestions":"You need to answer a few questions about yourself and your appeal to get started.","finishQuestions":"You need to finish telling us about your appeal.","needHomeOfficeDecision":"You will need to have your Home Office decision letter with you to answer some questions."},"appealSubmitted":{"detailsSent":"Your appeal details have been sent to the Tribunal.","dueDate":"A Tribunal Caseworker will contact you by <span  class=\'govuk-body govuk-!-font-weight-bold\'> {{ applicationNextStep.deadline }}</span>  to tell you what to do next.","info":{"title":"Helpful Information","url":"<a href=\\"#\\">What is a Tribunal Caseworker?</a>"}},"reasonsForAppealSubmitted":{"detailsSent":"You have told us why you think the Home Office decision is wrong.","dueDate":"A Tribunal Caseworker will contact you by <span class=\'govuk-body govuk-!-font-weight-bold\'>Date TBC</span> to tell you what to do next."}},"answersBeenSaved":"Your answers have been saved","timeline":{"completed":"Completed","submitAppeal":{"title":"Your appeal details","text":"You sent your appeal details to the Tribunal.","links":[{"title":"What you sent","text":"Your appeal details","href":"/appeal-details"},{"title":"Helpful information","text":"What is a Tribunal Caseworker","href":"/tribunal-caseworker"}]},"submitReasonsForAppeal":{"title":"Your appeal argument","text":"You told us why you think the Home Office decision to refuse your claim is wrong.","links":[{"title":"What you sent","text":"Why you think the Home Office is wrong","href":"/appeal-reasons"},{"title":"Useful documents","text":"Home Office documents about your case","href":"/view/home-office-documents"},{"title":"Helpful information","text":"Understanding your Home Office documents","href":"/home-office-documents"}]},"reasonsForAppealCheckAnswersHistory":{"title":"Why you think the Home Office is wrong","question":"Question","whyYouThinkHomeOfficeIsWrong":"Why do you think the Home Office decision is wrong?"},"appealApplicationCheckAnswersHistory":{"title":"Your appeal details"}}},"eligibleStartPage":{"newService":"This is a new online service for people appealing an immigration or asylum decision. Because it is a new service, not everyone will be able to use it right now.","askQuestions":"We need to ask you a few questions to see if the service is suitable for you.","alreadyStarted":"Have you already started an appeal?","signIn":"Sign in to continue with your appeal"},"guidancePages":{"caseWorker":{"title":"What is a Tribunal Caseworker?","titleText":"A Tribunal Caseworker manages immigration and asylum appeals to make sure everything is ready for a decision to be made about your appeal.","textAndBullets":[{"smallTitle":"What a Tribunal Caseworker does","title":"A Tribunal Caseworker:","bullets":["works with you and the Home Office to manage an appeal from start to finish","looks at any information you or the Home Office send the Tribunal","tells you or the Home Office what to do at each stage of the appeal and when it needs to be done by","tells you or the Home Office if there is anything you need to know about your appeal. For example, if you or the Home Office withdraws from the appeal","may decide to grant or refuse any applications you or the Home Office make to the Tribunal. For example, if you or the Home Office ask for more time","is not a Judge but does work closely with Judges"],"desc":"If you disagree with a decision a Tribunal Caseworker makes, you have 14 days to ask the Tribunal for a Judge to review the decision."},{"smallTitle":"What a Tribunal Caseworker can’t do","title":"A Tribunal Caseworker cannot:","bullets":["offer legal advice","go to a hearing with you","decide the outcome of your appeal"]}]},"homeOfficeDocuments":{"title":"Understanding your Home Office documents","titleText":"As part of the appeal process, the Home Office must send the Tribunal all the documents it has about your case. This is called the Home Office bundle.","textAndBullets":[{"title":"The Home Office bundle has two parts:","bullets":["Cover letter","Documents about your case"]},{"smallTitle":"Cover letter","title":"The cover letter is the first page of your bundle and contains:","bullets":["your personal details and any Home Office or other reference numbers","a record of the decision to refuse your claim","your immigration history. For example, the date you arrived in the country, the date you made your claim and any other relevant dates","a list of the documents that are in the bundle and their page numbers. Details of the documents that might be in your bundle are in the next section","the date you decided to appeal"]},{"smallTitle":"Documents about your case","title":"Your bundle will include some or all of the following documents:","bulletsSpacing":["<span  class=\'govuk-body govuk-!-font-weight-bold\'> Visa Application Form:</span>  If you made a Visa application, the application form and any evidence relevant to the decision to refuse you claim will be included in the bundle","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Screening Interview:</span>  If you have claimed asylum, the Screening Interview is the first interview that takes place. The bundle will include a written record of the interview","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Asylum Interview Record:</span>  If you have claimed asylum, the Asylum Interview (also known as the Asylum Substantive Interview) is when the Home Office asks you in detail about your reasons for claiming asylum. The bundle will include a written record of the interview","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Documents submitted by appellant in support of claim:</span>  This is any supporting evidence that you gave to the Home Office as part of your claim. This could be a witness statement, medical records or official documents such as a birth certificate","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Previous refusal:</span>  If you made a previous claim that was refused, any documents related to this claim will be included in the bundle","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Previous appeal:</span>  If you made a previous appeal that was dismissed, any documents related to this appeal may be included in the bundle","<span  class=\'govuk-body govuk-!-font-weight-bold\'> Decision letter:</span>  This is the letter that explains why the Home Office refused your claim. A decision letter is sent to you by post and you should have a copy"]},{"smallTitle":"Where to find your Home Office bundle","desc":"Your Home Office bundle is accessible from the Overview page. <a class=\\"govuk-link\\" href=\\"/appeal-overview\\">Return to your Overview page</a> and click Home Office documents about your case to access your Home Office bundle. "},{"smallTitle":"Contact us for help","desc":"If you need help understanding your Home Office documents, you can call <span  class=\'govuk-body govuk-!-font-weight-bold\'> 0300 123 1711</span>  or email <a class=\\"govuk-link\\" href=\\"mailto:customer.service@justice.gov.uk\\">customer.service@justice.gov.uk</a>"}]},"helpWithAppeal":{"title":"Get help with your appeal","titleText":"There are a number of ways to get advice on appealing an asylum or immigration decision.","textAndBullets":[{"smallTitle":"Asylum helplines","title":"Get advice over the phone on the asylum process, including appealing an asylum decision.","textLink":"https://www.gov.uk/asylum-helplines"},{"smallTitle":"Find an immigration adviser","title":"Find registered immigration advisers in your area who may be able to help with your appeal.","textLink":"https://www.gov.uk/find-an-immigration-adviser"},{"smallTitle":"Find a legal aid adviser","title":"Legal aid can help pay for legal advice. <a class=\\"govuk-link\\" href=\\"https://www.gov.uk/check-legal-aid\\">Check if you qualify for legal aid.</a>","text":"If you do qualify, you can search for a legal adviser with a legal aid contract in England and Wales.","textLink":"https://find-legal-advice.justice.gov.uk/"},{"smallTitle":"Citizens Advice ","title":"Get free, confidential help from your local Citizens Advice on a range of immigration issues. Please note that Citizens Advice does not currently offer advice on asylum issues.","link":"https://www.citizensadvice.org.uk/immigration/get-help/get-immigration-advice/"}]},"evidenceToSupportAppeal":{"title":"Evidence to support your appeal","titleText":"Evidence is any information that supports your appeal.","textAndBullets":[{"title":"Anything you tell the Tribunal is evidence. It is likely to help your case if you can provide further relevant evidence to prove what you say is true. For example, if you tell the Tribunal you are a citizen of a particular country, a copy of your passport is further evidence that this is true.","desc":"Here are some examples of different kinds of evidence that could support your appeal. "},{"smallTitle":"Witness statement","title":"A witness is someone who comes to a hearing to speak on your behalf. This is known as oral evidence. A witness could be:","bullets":["a community leader","a religious leader","a social worker","anybody who knows something relevant about your case"],"desc":"All witnesses must write a witness statement, which is a written version of their oral evidence. The witness statement should include the appeal reference number as well as the witness’ address, date of birth, signature and photo identification."},{"smallTitle":"Letter of support","title":"A letter of support is usually written by someone who knows you well such as a friend or family member. The letter normally explains how the writer knows you and describes what kind of person they think you are.","text":"A letter of support should include the appeal reference number as well as the supporter’s address, date of birth, signature and photo identification."},{"smallTitle":"Country evidence","title":"You can use information or reports about a country to support anything you have said about that country in your appeal. Examples include:","bullets":["official country reports (for example, Home Office or US State Department country reports)","country expert reports (for example, from an academic specialising in that country)","<a class=\\"govuk-link\\" href=\\"https://www.gov.uk/government/collections/country-policy-and-information-notes\\">UK government country guidance reports</a>","news reports","cases the Tribunal has already heard about your country"]},{"smallTitle":"Evidence of participation in groups ","title":"There are a number of ways you can show your connection to a particular group or involvement in public demonstrations. Examples include:","bullets":["social media posts","photos/videos of events","news reports","membership information"]},{"smallTitle":"Relationship evidence ","title":"You may need evidence to prove your relationship with a child, spouse or other family member. Examples include:","bullets":["email, text or WhatsApp messages","school reports","teachers\' letters","social worker reports"]},{"smallTitle":"Medical evidence","title":"You may need evidence for any physical or mental health conditions you want to tell the Tribunal about. Examples include:","bullets":["prescriptions","letters from your doctor","GP notes","expert reports","other medical reports"]},{"smallTitle":"Criminal evidence","title":"You may need evidence to show if you have been arrested or involved in any criminal activity that is relevant to your appeal. This could be from your home country or the UK. Examples include:","bullets":["arrest records","police reports","court reports","first instance reports, if your case refers to alleged criminal activity in your home country"]},{"smallTitle":" Official documents","title":"You may need to provide official documents to prove your nationality or family relationships. Examples include:","bullets":["birth certificates","marriage certificates","passports","identity cards"]},{"smallTitle":"Financial evidence","title":"You may need to provide evidence to prove your financial situation. Examples include:","bullets":["payslips","bank records","work records","no recourse to public funds/local authority letters"]},{"smallTitle":"Educational evidence","title":"You may need to provide evidence of any courses you have taken and awards you have received. Examples include:","bullets":["certificates","evidence of enrollment","reports"]},{"smallTitle":"Legal evidence","title":"It may be helpful to use legal arguments and documents to support your appeal. Examples include:","bullets":["legal precedents","decisions of cases linked to yours (for example, a family member or someone in a similar situation)","decisions of cases from your home country"]}]}},"termsAndConditions":{"title":"Terms and conditions","description":"By using this service you’re agreeing to the following terms of use. This includes the <a href=\'/privacy-policy\'>privacy policy</a>.","sections":[{"title":"Who we are","content":["This service is managed by Her Majesty’s Courts and Tribunals Service.","You should check these terms and conditions regularly. We may update them at any time without notice. If you continue to use this service after the terms and conditions have changed, you are deemed to have agreed to the changes."]},{"title":"Information provided by this service","content":["This service provides information to support your claim or application. We cannot give legal advice on individual cases.","You should answer the questions in the service based on your circumstances and seek legal advice if you need it."]},{"title":"Sharing and storing data","content":["Our <a class=\'govuk-link\' href=\'/privacy-policy\'>privacy policy</a> explains where your data is stored, and who it is shared with.","Our <a class=\'govuk-link\' href=\'/cookie-policy\'>cookie policy</a> explains how this service uses and stores cookies."]},{"title":"Laws applying to this service","content":["Your use of this service and any dispute arising from its use will be governed by and construed in accordance with the laws of England and Wales, including but not limited to the:","<ul class=\'govuk-list govuk-list--bullet\'><li>Computer Misuse Act 1990</li><li>Data Protection Act 1998 (until 25 May 2018)</li><li>Data Protection Act 2018 (from 25 May 2018)</li><li>General Data Protection Regulation</li><li>Mental Capacity Act 2005</li></ul>"]},{"title":"How to use this service responsibly","content":["There are risks in using a shared computer (for example, in a library) to access this service. It’s your responsibility to be aware of these risks and to avoid using any computer which may leave your personal information accessible to others. You’re responsible if you choose to leave a computer unprotected while using this service.","You should take your own precautions to ensure that the way you access this service does not expose you to the risk of:","<ul class=\'govuk-list govuk-list--bullet\'><li>viruses</li><li>malicious computer code</li><li>other forms of interference which may damage your computer system</li></ul>","You must not misuse this service by knowingly introducing viruses, trojans, worms, logic bombs or other material which is malicious or technologically harmful. You must not attempt to gain unauthorised access to this service, the system on which it is stored, or any server, computer or database connected to it. You must not attack this site using a denial-of-service attack or a distributed denial-of-service attack."]},{"title":"Entering personally sensitive information","content":["This online service contains several free-text fields in which you may choose to enter information which is personally sensitive.","If you enter information about your:","<ul class=\'govuk-list govuk-list--bullet\'><li>religious beliefs</li><li>sexual orientation or sex life</li><li>racial or ethnic origins</li><li>political opinions</li><li>religious or philosophical beliefs</li><li>trade union membership</li><li>genetic data or biometric data</li><li>health data</li></ul>","You give us your consent to processing this information for the purpose of dealing with your application.","For more information about how we collect and store your personal data, see the privacy policy"]},{"title":"Disclaimer","content":["While we make every effort to keep information up to date, we don’t provide any guarantees, conditions or warranties that it will be:","<ul class=\'govuk-list govuk-list--bullet\'><li>current</li><li>secure</li><li>accurate</li><li>complete</li><li>free from bugs or viruses</li></ul>","We don’t publish advice. You should get professional or specialist advice before doing anything on the basis of the information in the service.","We’re not liable for any loss or damage that may come from using this service. This includes:","<ul class=\'govuk-list govuk-list--bullet\'><li>any direct, indirect or consequential losses</li><li>any loss or damage caused by civil wrongs (‘tort’, including negligence), breach of contract or otherwise</li><li>the use of this service, GOV.UK and any websites that are linked to or from it</li><li>the inability to use this service, GOV.UK and any websites that are linked to or from it</li></ul>","This applies if the loss or damage was foreseeable, arose in the normal course of things or you advised us that it might happen.","This includes (but isn’t limited to) the loss of your:","<ul class=\'govuk-list govuk-list--bullet\'><li>income or revenue</li><li>salary, benefits or other payments</li><li>business</li><li>profits or contracts</li><li>opportunity</li><li>anticipated savings</li><li>data</li><li>goodwill or reputation</li><li>intangible property, including loss, corruption or damage to data or any computer system</li><li>wasted management or office time</li></ul>","We may still be liable for:","<ul class=\'govuk-list govuk-list--bullet\'><li>death or personal injury arising from our negligence</li><li>fraudulent misrepresentation</li><li>any other liability which cannot be excluded or limited under applicable law</li></ul>","<a class=\'govuk-link\' href=\'https://hmcts-access.service.gov.uk/contact-us\'>Contact us</a> for further information."]}]},"cookies":{"title":"Cookies","pageTitle":"Cookies policy","description":"A cookie is a small piece of data that’s stored on your computer, tablet, or phone when you visit a website. Most websites need cookies to work properly.","sections":[{"title":"How cookies are used in this service","content":["This service uses them to:","<ul class=\'govuk-list govuk-list--bullet\'><li>measure how you use the service so it can be improved</li><li>remember the notifications you’ve seen so that you’re not shown them again</li><li>temporarily store the answers you give</li></ul>","Find out more about <a class=\'govuk-link\' href=\'http://www.aboutcookies.org/\'>how to manage cookies</a>."]},{"title":"Cookies used to measure website usage","content":["We use Google Analytics software to collect information about how you use this service. We do this to help make sure the service is meeting the needs of its users and to help us make improvements, for example improving site search.","Google Analytics stores information about:","<ul class=\'govuk-list govuk-list--bullet\'><li>the pages you visit</li><li>how long you spend on each page</li><li>how you got to the service</li><li>what you click on while you’re visiting the service</li></ul>","We allow Google to use or share this data. Find out more about how they use this information in the <a class=\'govuk-link\' href=\'https://policies.google.com/privacy/partners?hl=en-GB&gl=uk\'>Google privacy policy</a>.","You can <a class=\'govuk-link\' href=\'https://policies.google.com/privacy/partners?hl=en-GB&gl=uk\'>opt out of Google Analytics</a> if you do not want Google to have access to your information.","Google Analytics sets the following cookies:",{"table":{"head":[{"text":"Cookie name"},{"text":"What this cookie is for"},{"text":"Expires after"}],"rows":[[{"text":"_ga"},{"text":"This helps us count how many people visit the service by tracking if you’ve visited before"},{"text":"2 years"}],[{"text":"_gid"},{"text":"Identifies you to the service"},{"text":"24 hours"}]]}}]},{"title":"Cookies used to turn our introductory message off","content":["You may see a welcome message when you first visit the service. We’ll store a cookie so that your computer knows not to show this message again.",{"table":{"head":[{"text":"Cookie name"},{"text":"What this cookie is for"},{"text":"Expires after"}],"rows":[[{"text":"seen_cookie_message"},{"text":"Saves a message to let us know that you’ve seen our cookie message"},{"text":"1 month"}]]}}]},{"title":"Cookies used to store the answers you’ve given during your visit (known as a ‘session’)","content":["Session cookies are stored on your computer as you browse a website, and let the website know what you’ve seen and done so far. These are temporary cookies and are automatically deleted after you leave the website.",{"table":{"head":[{"text":"Cookie name"},{"text":"What this cookie is for"},{"text":"Expires after"}],"rows":[[{"text":"session"},{"text":"Keeps track of your answers"},{"text":"When you close your browser"}],[{"text":"ARRAffinity"},{"text":"To know which internal IP a request should be routed to."},{"text":"When you close your browser"}]]}}]}]},"privacyPolicy":{"title":"Privacy policy","description":"This privacy policy explains why we collect your personal data and what we do with it. It also explains your rights and how to enforce them.","sections":[{"title":"Who manages this service","content":["This service is managed by HM Courts and Tribunals Service (HMCTS), which is an executive agency of the Ministry of Justice (MoJ).","The MoJ is known as the data controller for data protection purposes. The <a class=\'govuk-link\' href=\'https://www.gov.uk/government/organisations/ministry-of-justice/about/personal-information-charter\'>MoJ personal information charter</a> explains how the MoJ processes personal data.","As part of the MoJ, HMCTS is responsible for deciding how your personal data is used and for protecting the personal data you provide.","More information about using this service is in the <a class=\'govuk-link\' href=\'/terms-and-conditions\'>terms and conditions</a>"]},{"title":"Why we collect your personal data","content":["We collect your personal data to:","<ul class=\'govuk-list govuk-list--bullet\'><li>process your claim or application</li><li>meet legal requirements</li><li>make improvements to this service</li></ul>","Our staff use your personal data to process your claim or application. They work in the UK and your data is stored in the UK."]},{"title":"Types of personal data we collect","content":["The personal data we collect includes:","<ul class=\'govuk-list govuk-list--bullet\'><li>your name, address and contact details</li><li>your email and password (if you create an account)</li><li>other personal information you provide in your claim or application</li></ul>","Some services collect more personal data. Find out more about the <a class=\'govuk-link\' href=\'#using-your-data\'>personal data that is collected by the service you are using</a>."]},{"title":"Using your data","id":"using-your-data","content":["As part of your claim you’ll be asked to use your email address to set up an account. You will be able to use this email and password to sign into other HMCTS services.","We may ask for your permission to use your email address to send you emails using GOV.UK Notify. This system processes emails only within the European Economic Area until the point where emails are handed over to the email provider you use.","We <a class=\'govuk-link\' href=\'/cookie-policy\'>use cookies</a> to collect data that tells us about how you’re using this service, including:","<ul class=\'govuk-list govuk-list--bullet\'><li>if you open an email from us or click on a link in an email</li><li>your computer, phone or tablet’s IP address</li><li>the region or town where you are using your computer, phone or tablet</li><li>the web browser you use</li></ul>"]},{"title":"Storing your data","content":["When you make your claim or application we store the data you have provided. This is stored in the UK. The amount of time that your data is kept for depends on the service that you are using.","Find out more about <a class=\'govuk-link\' href=\'#using-appeal-service\'>how long your personal data is stored by the service you are using</a>."]},{"title":"Sharing your data","content":["While processing your claim or application, another government department, agency or organisation might be involved and we may share your data with them.","If you contact us and ask for help with the service you are using, your personal data may be shared with the Good Things Foundation. This is a company who we have partnered with to offer face to face support.","In some circumstances we may share your data for example, to prevent or detect crime, or to produce anonymised statistics.","We use Google Analytics to collect data about how a website is used. This anonymous data is shared with Google. Find out about this in our <a class=\'govuk-link\' href=\'/terms-and-conditions\'>terms and conditions</a>."]},{"title":"Storing and sharing your data internationally","content":["Sometimes we need to send your personal information outside of the UK. When we do this we comply with data protection law."]},{"title":"Your rights","content":["You can ask:","<ul class=\'govuk-list govuk-list--bullet\'><li>to see the personal data that we hold on you</li><li>to have the personal data corrected</li><li>to have the personal data removed or deleted (this will depend on the circumstances, for example if you decide not to continue your claim or application)</li><li>that access to the personal data is restricted (for example, you can ask to have your data stored for longer and not automatically deleted)</li></ul>","If you want to see the personal data that we hold on you, you can:","<ul class=\'govuk-list govuk-list--bullet\'><li>complete a form to <a class=\'govuk-link\' href=\'https://www.gov.uk/government/publications/request-your-personal-data-from-moj\'>make a subject access request</a>. Your request goes to the MoJ as data controller.</li><li>write to us: Disclosure Team, Post point 10.38, 102 Petty France, London, SW1H 9AJ</li></ul>","You can ask for more information about:","<ul class=\'govuk-list govuk-list--bullet\'><li>agreements we have on sharing information with other organisations</li><li>when we are allowed to pass on personal information without telling you</li><li>our instructions to staff on how to collect, use or delete your personal information</li><li>how we check that the information we hold is accurate and up-to-date</li></ul>","You can contact the MoJ data protection officer, by:","<ul class=\'govuk-list govuk-list--bullet\'><li>writing to us: Post point 10.38, 102 Petty France, London, SW1H 9AJ</li><li>emailing: data.compliance@justice.gov.uk</li></ul>"]},{"title":"How to complain","content":["See our <a class=\'govuk-link\' href=\'https://www.gov.uk/government/organisations/hm-courts-and-tribunals-service/about/complaints-procedure\'>complaints procedure</a> if you want to complain about how we\'ve handled your personal data.","Write to: Post point 10.38, 102 Petty France, London, SW1H 9AJ","Email: data.compliance@justice.gov.uk","You can also complain to the <a class=\'govuk-link\' href=\'https://ico.org.uk/global/contact-us\'>Information Commissioner’s Office</a> if you’re not satisfied with our response or believe we are not processing your personal data lawfully."]},{"title":"Using the Appeal an immigration or asylum decision service","id":"using-appeal-service","content":["<h3 class=\'govuk-heading-s\'>The personal data we need</h3>","When you use the appeal an immigration or asylum decision service we ask for:","<ul class=\'govuk-list govuk-list--bullet\'><li>your name</li><li>your date of birth</li><li>your nationality</li><li>your email or mobile phone number</li><li>your address</li><li>your appeal type</li><li>information from the Home Office decision letter</li><li>information on any support you need for a case management appointment or hearing, if you attend one</li></ul>","<h3 class=\'govuk-heading-s\'>Storing and sharing your data</h3>","Your data will be shared with the government department that made the decision you are appealing against. For example, the Ministry of Justice. This is so that the department can respond to your appeal.","<h3 class=\'govuk-heading-s\'>After you submit your information</h3>","The information you submit will be deleted 2 years after the Tribunal has issued its decision and the last update has been made to your appeal.","If the Tribunal doesn’t make a decision about your appeal (for example, it is withdrawn, or both parties agree) then the information you provide will be deleted 2 years after the appeal has been closed and the last update made.","If you make a complaint against the Tribunal then information about the appeal is stored for 3 years after the last update on the complaint."]}]}},"error":{"summary":{"title":"There is a problem","description":"This is a description."},"error404":{"title":"Page not found","header":"Page not found","checkAddress":"Check that you have entered the correct web address.","orText":"Or","goBackToStart":"go back to the Start page."},"error500":{"title":"Service unavailable","header":"Sorry, there is a problem with this service","tryAgain":"Please try again later."}},"cookieBanner":{"content":"GOV.UK uses cookies to make the site simpler. <a href=\'/cookie-policy\' class=\'govuk-link\' title=\'Find out more about cookies\'>Find out more about cookies</a>"},"validationErrors":{"errorSummary":"There is a problem","required":"The field is required","empty":"The field is required","stringMin":"Please add some more detail.","homeOfficeRef":"The Home Office Number is not correct. Please review it.","selectAnAppealType":"Select an appeal type","emailEmpty":"Enter an email address","emailFormat":"Enter an email address in the correct format, like name@example.com","phoneEmpty":"Enter a phone number","phoneFormat":"Enter a mobile phone number, like 07700 900 982 or +61 2 9999 9999","acceptanceStatement":"Select if you believe the information you have given is true.","contactDetails":{"selectOneOption":"Select at least one of the contact options"},"givenNames":"Enter your given name or names","familyName":"Enter your family name or names","dateOfBirth":{"missing":"Your date of birth must include a day, month and year","incorrectFormat":"Enter the date in the correct format","inPast":"Your date of birth must be in the past","underAge":"You must be at least 18 years old to use this service"},"dateLetterSent":{"missing":"Date letter sent must include a day, month and year","incorrectFormat":"Enter the date in the correct format","inPast":"The date letter was sent must be in the past","underAge":"You must be at least 18 years old to use this service"},"nationality":{"selectNationality":"Select your Nationality","onlyOne":"Only select one option"},"postcode":{"empty":"Enter your postcode","invalid":"Enter a valid postcode"},"address":{"required":"Select your address","line1Required":"Enter a building number and street name","townCityRequired":"Enter a Town or City","postcodeRequired":"Enter your postcode"},"homeOfficeReference":{"required":"Enter the Home Office reference number","invalid":"Enter the Home Office reference number in the correct format"},"homeOfficeDecision":{"required":"Enter the reasons you think the Home Office decision is wrong"},"eligibility":{"selectYesOrNo":"Select either yes or no"},"emptyReasonAppealIsLate":"Enter the reason your appeal is late","reasonForAppeal":{"required":"Enter the reasons you think the Home Office decision is wrong","supportingEvidenceRequired":"Select Yes if you want to provide supporting evidence"},"fileUpload":{"noFileSelected":"Select a file","fileTooLarge":"The selected file must be smaller than","incorrectFormat":"The selected file must be a","fileCannotBeUploaded":"The file cannot be uploaded"}},"components":{"evidenceList":{"title":"Uploaded files","singleFileTitle":"Uploaded file","emptyList":"No files uploaded","delete":"Delete"},"date":{"day":"Day","month":"Month","year":"Year"},"contactUs":{"heading":"Contact us for help","content":"<div><p>Ask a question or get help in your language.</p></div><div><p class=\'govuk-body govuk-!-margin-bottom-0\'>Telephone: 0300 123 1711</p><p>Email: <a href=\'mailto:customer.service@justice.gov.uk\' class=\'govuk-link--no-visited-state govuk-body govuk-!-margin-bottom-3\'>customer.service@justice.gov.uk</a></p></div><div><p class=\'govuk-body govuk-!-margin-top-3 govuk-body govuk-!-margin-bottom-0\'>Monday to Friday, 8:30am to 5pm</p><a href=\'https://www.gov.uk/call-charges\' target=\'_blank\' rel=\'noopener noreferrer\' class=\'govuk-link--no-visited-state govuk-body govuk-!-margin-top-0\'>Find out about call charges</a><p>(opens in a new window)</p></div>"},"contactUsErrorPages":{"telephone":"Telephone: 0300 123 1711","linesOpeningTimes":"Lines open Monday to Friday 8.30am to 5pm","callCharges":"<a class=\'govuk-link\' href=\'https://www.gov.uk/call-charges\'>Find out about call charges</a>"},"header":{"signOut":"Sign out"},"footer":{"items":{"contactUs":{"href":"https://hmcts-access.service.gov.uk/contact-us","text":"Contact Us"},"cookies":{"text":"Cookies"},"termsAndConditions":{"text":"Terms and conditions"},"privacyPolicy":{"text":"Privacy policy"}}},"back":{"back":"Back"},"progressBar":{"yourAppealDetails":{"title":"Your appeal<br/> details","ariaLabel":"Your appeal details stage"},"yourAppealArgument":{"title":"Your appeal<br/> argument","ariaLabel":"Your appeal argument stage"},"yourHearingDetails":{"title":"Your hearing<br/> details","ariaLabel":"Your hearing details stage"},"yourAppealDecision":{"title":"Your appeal<br/> decision","ariaLabel":"Your appeal decision stage"}}},"appealTypes":{"protection":{"value":"protection","name":"Protection","title":"Protection (You will be persecuted or harmed in some way if you are returned to your home country)","examples":"You might be afraid of the government, police or other groups in your home country because of your nationality, race, religion, political opinion or other reason."},"revocationOfProtection":{"value":"revocationOfProtection","name":"Revocation of Protection Status","title":"Revocation of Protection Status (Your protection status was taken away)","examples":"Your protection status might have been taken away if it is believed you no longer need it, you didn’t tell the truth in your claim or you have committed a serious crime."}},"eligibility":[{"question":"Are you at least 18 years old?","eligibleAnswer":"yes","errorMessage":"Select yes if you are at least 18 years old"},{"question":"Are you currently living in England or Wales?","eligibleAnswer":"yes","errorMessage":"Select yes if you are currently living in England or Wales"},{"question":"Are you currently in detention?","description":"This could be a prison or an immigration removal centre.","eligibleAnswer":"no","errorMessage":"Select yes if you are currently in detention"},{"question":"Are you appealing an Asylum and/or Humanitarian Protection decision?","description":"You should answer yes if you fear you will be persecuted or harmed in some way if you are sent back to your home country.","eligibleAnswer":"yes","errorMessage":"Select yes if you are appealing an Asylum and/or Humanitarian Protection decision"},{"question":"Is anyone else in your immediate family appealing their own Home Office decision?","eligibleAnswer":"no","errorMessage":"Select yes if anyone in your immediate family is appealing their own Home Office decision"}]}')},function(e,a){e.exports=require("lodash")},function(e,a){e.exports=require("@hapi/joi")},function(e,a){e.exports=require("express")},function(e,a,t){"use strict";(function(e){t.d(a,"b",(function(){return h})),t.d(a,"a",(function(){return v}));var i=t(5),o=t.n(i),n=t(8),s=t.n(n),r=t(7);const l=o.a.get("ccd.apiUrl"),u=o.a.get("ccd.jurisdictionId"),c=o.a.get("ccd.caseType"),p=o.a.get("features.timelineEnabled"),d=new r.a,m=Object(r.b)(e),h={EDIT_APPEAL:{id:"editAppeal",summary:"Update appeal case AIP",description:"Update appeal case AIP"},SUBMIT_APPEAL:{id:"submitAppeal",summary:"Submit appeal case AIP",description:"Submit Appeal case AIP"},EDIT_REASONS_FOR_APPEAL:{id:"editReasonsForAppeal",summary:"Edit reasons for appeal case AIP",description:"Edit reasons for appeal case AIP"},SUBMIT_REASONS_FOR_APPEAL:{id:"submitReasonsForAppeal",summary:"Submits Reasons for appeal case AIP",description:"Submits Reasons for appeal case AIP"}};class v{createOptions(e,a,t){return{uri:t,headers:{Authorization:a.userToken,ServiceAuthorization:a.serviceToken,"content-type":"application/json"},json:!0}}startCreateCase(e,a){return s.a.get(this.createOptions(e,a,`${l}/citizens/${e}/jurisdictions/${u}/case-types/${c}/event-triggers/startAppeal/token`))}submitCreateCase(e,a,t){const i=this.createOptions(e,a,`${l}/citizens/${e}/jurisdictions/${u}/case-types/${c}/cases?ignore-warning=true`);return i.body=t,s.a.post(i)}startUpdateAppeal(e,a,t,i){return s.a.get(this.createOptions(e,i,`${l}/citizens/${e}/jurisdictions/${u}/case-types/${c}/cases/${a}/event-triggers/${t}/token`))}submitUpdateAppeal(e,a,t,i){const o=this.createOptions(e,t,`${l}/citizens/${e}/jurisdictions/${u}/case-types/${c}/cases/${a}/events`);return o.body=i,s.a.post(o)}loadCasesForUser(e,a){return s.a.get(this.createOptions(e,a,`${l}/citizens/${e}/jurisdictions/${u}/case-types/${c}/cases`))}retrieveCaseHistory(e,a,t){const i=this.createOptions(e,t,`${l}/caseworkers/${e}/jurisdictions/${u}/case-types/${c}/cases/${a}/events`);return s.a.get(i)}async createCase(e,a){const t=await this.startCreateCase(e,a);return await this.submitCreateCase(e,a,{event:{id:t.event_id,summary:"Create case AIP",description:"Create case AIP"},data:{journeyType:"aip"},event_token:t.token,ignore_warning:!0})}async updateAppeal(e,a,t,i){d.trace(`Received call to update appeal with event '${e.id}', user '${a}', updatedCase.id '${t.id}' `,m);const o=await this.startUpdateAppeal(a,t.id,e.id,i);return d.trace(`Submitting update appeal case with event '${e.id}'`,m),this.submitUpdateAppeal(a,t.id,i,{event:{id:o.event_id,summary:e.summary,description:e.summary},data:t.case_data,event_token:o.token,ignore_warning:!0})}async loadOrCreateCase(e,a){d.trace("Loading or creating case",m);const t=await this.loadCasesForUser(e,a);if(t.length>0)return d.trace(`found [${t.length}] cases`,m),t[0];return d.trace("Did not find a case",m),await this.createCase(e,a)}async getCaseHistory(e,a,t){d.trace(`Loading history for case with ID ${a}`,m);let i=[];if(p){i=function(e){return e.map(e=>({id:e.id,event:{eventName:e.event_name,description:e.description},user:{id:e.user_id,lastName:e.user_last_name,firstName:e.user_first_name},createdDate:e.created_date,caseTypeVersion:e.case_type_version,state:{id:e.state_id,name:e.state_name},data:e.data}))}(await this.retrieveCaseHistory(e,a,t))}return i}}}).call(this,"/index.js")},function(e,a){e.exports=require("config")},function(e,a){e.exports=require("moment")},function(e,a,t){"use strict";t.d(a,"a",(function(){return r})),t.d(a,"b",(function(){return l}));var i,o=t(15),n=t(17),s=t.n(n);!function(e){e[e.REQUEST=0]="REQUEST",e[e.TRACE=1]="TRACE",e[e.EXCEPTION=3]="EXCEPTION"}(i||(i={}));class r{constructor(e=null){this.client=null,e&&(o.setup(e).start(),this.client=o.defaultClient)}setIkey(e){o.setup(e).start(),this.client=o.defaultClient}request(e,a){this.client&&this.client.trackTrace({message:e}),this.console(e,a,i.REQUEST)}trace(e,a){this.client&&this.client.trackTrace({message:e}),this.console(e,a,i.TRACE)}exception(e,a){this.client&&this.client.trackException({exception:new Error(e)}),this.console(e,a,i.EXCEPTION)}console(e,a,t){const o=`[${a}]: ${e}`;switch(t){case i.REQUEST:console.log(s.a.white(`Request: ${o}`));break;case i.TRACE:console.warn(s.a.green(`Info: ${o} `));break;case i.EXCEPTION:console.error(s.a.red(`Exception: ${o}`))}}}function l(e){let a;return a=e.split("\\").pop().split("/"),a[a.length-2]+"/"+a[a.length-1]}},function(e,a){e.exports=require("request-promise")},function(e,a){e.exports=require("path")},function(e,a,t){"use strict";t.d(a,"a",(function(){return l}));var i=t(28),o=t(5),n=t.n(o),s=t(1);i.addTo(n.a);const r=(e,a)=>{Object(s.has)(n.a,e)&&Object(s.set)(n.a,a,Object(s.get)(n.a,e))},l=()=>(r("secrets.ia.idam-secret","idam.secret"),r("secrets.ia.addressLookupToken","addressLookup.token"),r("secrets.ia.s2s-secret","s2s.secret"),r("secrets.ia.ia-redis-connection-string","session.redis.url"),r("secrets.ia.ia-redis-access-key","session.redis.secret"),n.a)},function(e,a){e.exports=require("helmet")},function(e,a,t){"use strict";(function(e){t.d(a,"a",(function(){return v}));var i=t(27),o=t.n(i),n=t(10),s=t(29),r=t(7);const l=Object(n.a)(),u=t(44),c=l.get("s2s.secret"),p=l.get("s2s.url"),d=(l.get("proxy.host"),l.get("proxy.port"),l.get("s2s.microserviceName")),m=new r.a,h=Object(r.b)(e);class v{constructor(){this.initialization=this.init()}static getInstance(){return v.instance||(v.instance=new v),v.instance}async init(){await this.requestServiceToken()}buildRequest(){const e=`${p}/lease`,a=u(c).totp();return{uri:e,body:{microservice:d,oneTimePassword:a}}}async requestServiceToken(){m.trace("Attempting to request a S2S token",h);const e=this.buildRequest();let a;try{a=await o.a.post(e.uri,e.body,void 0)}catch(e){m.exception(e,h)}a&&a.data?(this.serviceToken=a.data,m.trace("Received S2S token and stored token",h)):m.exception("Could not retrieve S2S token",h)}async getServiceToken(){return Object(s.a)(this.serviceToken)&&(m.trace("Token expired Attempting to acquire a new one.",h),await this.requestServiceToken()),`Bearer ${this.serviceToken}`}setServiceToken(e){this.serviceToken=e}}}).call(this,"/index.js")},function(e,a){e.exports=require("@hmcts/ia-idam-express-middleware")},function(e,a){e.exports=require("nunjucks")},function(e,a){e.exports=require("applicationinsights")},function(e,a){e.exports=require("http-status-codes")},function(e,a){e.exports=require("chalk")},function(e,a){e.exports=require("google-libphonenumber")},function(e,a,t){"use strict";(function(e){t.d(a,"a",(function(){return r})),t.d(a,"b",(function(){return l}));var i=t(16),o=t(0),n=t(7);const s=Object(n.b)(e);function r(e,a,t){a.status(i.NOT_FOUND);const n=e.headers.accept.split(",");n.includes("text/html")?a.render("errors/404.njk"):n.includes("application/json")?a.send({error:i.NOT_FOUND,message:o.error.error404.title}):(a.type("text"),a.send(o.error.error404.title))}function l(e,a,t,n){a.app.locals.logger.exception(e,s),t.status(i.INTERNAL_SERVER_ERROR);const r=a.headers.accept.split(",");r.includes("text/html")?t.render("errors/500.njk"):r.includes("application/json")?t.send({error:i.INTERNAL_SERVER_ERROR,message:o.error.error500.title}):(t.type("text"),t.send(o.error.error500.title))}}).call(this,"/index.js")},function(e,a){e.exports=require("body-parser")},function(e,a){e.exports=require("cookie-parser")},function(e,a){e.exports=require("csurf")},function(e,a){e.exports=require("expect-ct")},function(e,a){e.exports=require("webpack")},function(e,a){e.exports=require("webpack-dev-middleware")},function(e,a,t){const i=t(39),o=t(40),n={server:{mode:"development",devtool:"inline-source-map"},client:{mode:"development",devtool:"inline-source-map"}};e.exports=i.multiple(o,n)},function(e,a){e.exports=require("axios")},function(e,a){e.exports=require("@hmcts/properties-volume")},function(e,a,t){"use strict";(function(e){t.d(a,"a",(function(){return l}));var i=t(30),o=t.n(i),n=t(7);const s=new n.a,r=Object(n.b)(e);function l(e){let a=new Date,t=!1;const i=function(e){let a;try{a=o.a.decode(e)}catch(e){throw s.exception(e,r),new Error(e)}return a}(e);return i&&i.exp<a.getUTCMilliseconds()-2e4&&(t=!0),t}}).call(this,"/index.js")},function(e,a){e.exports=require("jsonwebtoken")},function(e,a){e.exports=require("@hmcts/os-places-client")},function(e,a){e.exports=require("request-promise-native")},function(e,a,t){"use strict";(function(e){t.d(a,"a",(function(){return d}));var i=t(5),o=t.n(i),n=t(8),s=t.n(n),r=t(7);const l=o.a.get("documentManagement.apiUrl"),u=new r.a,c=Object(r.b)(e);var p;!function(e){e.public="PUBLIC",e.private="PRIVATE",e.restricted="RESTRICTED"}(p||(p={}));class d{constructor(e){this.authenticationService=e}createOptions(e,a,t){return{uri:t,headers:{Authorization:a.userToken,ServiceAuthorization:a.serviceToken,"user-id":e}}}async upload(e,a,t){const i=this.createOptions(e,a,`${l}/documents`);return i.formData={files:[{value:t.file.buffer,options:{filename:`${Date.now()}-${t.file.originalname}`,contentType:t.file.mimetype}}],classification:t.classification,role:t.role},s.a.post(i)}async delete(e,a,t){const i=this.createOptions(e,a,t);return s.a.delete(i)}async uploadFile(e){const a=await this.authenticationService.getSecurityHeaders(e),t=e.idam.userDetails.uid;u.trace(`Received call to upload file for user with id: '${t}'`,c);const i={file:e.file,role:"citizen",classification:p.restricted};return this.upload(t,a,i).then(e=>{const a=JSON.parse(e),t=a._embedded.documents[0].originalDocumentName;return{id:t,url:a._embedded.documents[0]._links.self.href,name:t.substring(t.indexOf("-")+1)}})}async deleteFile(e,a){const t=await this.authenticationService.getSecurityHeaders(e),i=e.idam.userDetails.uid;return u.trace(`Received call from user '${i}' to delete`,c),this.delete(i,t,a)}}}).call(this,"/index.js")},function(e,a,t){"use strict";var i=t(20),o=t.n(i),n=t(21),s=t.n(n),r=t(22),l=t.n(r),u=t(23),c=t.n(u),p=t(3),d=t.n(p),m=t(11),h=t.n(m),v=(t(24),t(25),t(0)),f=(t(26),t(5)),g=t.n(f),y=t(1),b=t.n(y),w=t(14),k=t(9),A=t.n(k);const T={index:"/",health:"/health",overview:"/appeal-overview",liveness:"/liveness",healthLiveness:"/health/liveness",taskList:"/about-appeal",login:"/login",logout:"/logout",redirectUrl:"/redirectUrl",start:"/start-appeal",confirmation:"/appeals-details-sent",tribunalCaseworker:"/tribunal-caseworker",moreHelp:"/appeal-help",evidenceToSupportAppeal:"/supporting-evidence",homeOfficeDocuments:"/home-office-documents",personalDetails:{name:"/name",nationality:"/nationality",dob:"/date-birth",enterPostcode:"/address",enterAddress:"/manual-address",postcodeLookup:"/select-address"},homeOffice:{details:"/home-office-reference-number",letterSent:"/date-letter-sent",appealLate:"/late-appeal",uploadEvidence:"/home-office/upload-evidence",deleteEvidence:"/home-office/delete-evidence"},reasonsForAppeal:{decision:"/case-building/home-office-decision-wrong",supportingEvidence:"/case-building/supporting-evidence",supportingEvidenceUpload:"/case-building/provide-supporting-evidence",supportingEvidenceUploadFile:"/case-building/reason-for-appeal/supporting-evidence/upload/file",supportingEvidenceDeleteFile:"/case-building/reason-for-appeal/supporting-evidence/delete/file",supportingEvidenceSubmit:"/case-building/reason-for-appeal/supporting-evidence/submit",checkAndSend:"/case-building/check-answer",confirmation:"/case-building/answer-sent"},caseBuilding:{timeline:"/case-building/timeline"},typeOfAppeal:"/appeal-type",contactDetails:"/contact-preferences",checkAndSend:"/check-answers",eligibility:{start:"/eligibility-start",ineligible:"/not-eligible",questions:"/eligibility",eligible:"/eligible"},footer:{cookies:"/cookie-policy",termsAndConditions:"/terms-and-conditions",privacyPolicy:"/privacy-policy"},detailsViewers:{document:"/view/document",homeOfficeDocuments:"/view/home-office-documents",appealDetails:"/appeal-details",reasonsForAppeal:"/appeal-reasons"}};var S=t(12),E=t(7);var D=t(19);function O(e,a,t){a.locals.authenticated=!(!e.cookies||!e.cookies["__auth-token"]),t()}const x="logErrorMiddleware",P="logRequestMiddleware";function F(e,a,t){e.app.locals.logger.request(`[${e.method}] ${e.originalUrl}`,P),t()}function L(e,a,t,i){const o=a.app.locals.logger,n=e.stack?`\n${e.stack}`:"";o.exception(`[${a.method}] ${a.originalUrl}. Error ${e.message}${n}`,x),i(e)}const N=t(45),{JSDOM:C}=t(46),I=N(new C("").window);function R(e,a,t){Object.keys(e.body).forEach(a=>{e.body[a]=I.sanitize(e.body[a],{ALLOWED_TAGS:[]}).trim()}),t()}var j=t(31),Y=t(32),M=t.n(Y),q=t(6),H=t.n(q);const U=[{value:"AF",name:"Afghanistan"},{value:"AX",name:"Aland Islands"},{value:"AL",name:"Albania"},{value:"DZ",name:"Algeria"},{value:"AS",name:"American Samoa"},{value:"AD",name:"Andorra"},{value:"AO",name:"Angola"},{value:"AI",name:"Anguilla"},{value:"AQ",name:"Antarctica"},{value:"AG",name:"Antigua and Barbuda"},{value:"AR",name:"Argentina"},{value:"AM",name:"Armenia"},{value:"AW",name:"Aruba"},{value:"AU",name:"Australia"},{value:"AT",name:"Austria"},{value:"AZ",name:"Azerbaijan"},{value:"BS",name:"Bahamas"},{value:"BH",name:"Bahrain"},{value:"BD",name:"Bangladesh"},{value:"BB",name:"Barbados"},{value:"BY",name:"Belarus"},{value:"BE",name:"Belgium"},{value:"BZ",name:"Belize"},{value:"BJ",name:"Benin"},{value:"BM",name:"Bermuda"},{value:"BT",name:"Bhutan"},{value:"BO",name:"Bolivia"},{value:"BQ",name:"Bonaire, Sint Eustatius and Saba"},{value:"BA",name:"Bosnia and Herzegovina"},{value:"BW",name:"Botswana"},{value:"BV",name:"Bouvet Island"},{value:"BR",name:"Brazil"},{value:"VG",name:"British Virgin Islands"},{value:"IO",name:"British Indian Ocean Territory"},{value:"BN",name:"Brunei Darussalam"},{value:"BG",name:"Bulgaria"},{value:"BF",name:"Burkina Faso"},{value:"BI",name:"Burundi"},{value:"KH",name:"Cambodia"},{value:"CM",name:"Cameroon"},{value:"CA",name:"Canada"},{value:"CV",name:"Cape Verde"},{value:"KY",name:"Cayman Islands"},{value:"CF",name:"Central African Republic"},{value:"TD",name:"Chad"},{value:"CL",name:"Chile"},{value:"CN",name:"China"},{value:"HK",name:"Hong Kong, Special Administrative Region of China"},{value:"MO",name:"Macao, Special Administrative Region of China"},{value:"CX",name:"Christmas Island"},{value:"CC",name:"Cocos (Keeling) Islands"},{value:"CO",name:"Colombia"},{value:"KM",name:"Comoros"},{value:"CG",name:"Congo (Brazzaville)"},{value:"CD",name:"Congo, Democratic Republic of the"},{value:"CK",name:"Cook Islands"},{value:"CR",name:"Costa Rica"},{value:"CI",name:"Côte d'Ivoire"},{value:"HR",name:"Croatia"},{value:"CU",name:"Cuba"},{value:"CW",name:"Curaçao"},{value:"CY",name:"Cyprus"},{value:"CZ",name:"Czech Republic"},{value:"DK",name:"Denmark"},{value:"DJ",name:"Djibouti"},{value:"DM",name:"Dominica"},{value:"DO",name:"Dominican Republic"},{value:"EC",name:"Ecuador"},{value:"EG",name:"Egypt"},{value:"SV",name:"El Salvador"},{value:"GQ",name:"Equatorial Guinea"},{value:"ER",name:"Eritrea"},{value:"EE",name:"Estonia"},{value:"ET",name:"Ethiopia"},{value:"FK",name:"Falkland Islands (Malvinas)"},{value:"FO",name:"Faroe Islands"},{value:"FJ",name:"Fiji"},{value:"FI",name:"Finland"},{value:"FR",name:"France"},{value:"GF",name:"French Guiana"},{value:"PF",name:"French Polynesia"},{value:"TF",name:"French Southern Territories"},{value:"GA",name:"Gabon"},{value:"GM",name:"Gambia"},{value:"GE",name:"Georgia"},{value:"DE",name:"Germany"},{value:"GH",name:"Ghana"},{value:"GI",name:"Gibraltar"},{value:"GR",name:"Greece"},{value:"GL",name:"Greenland"},{value:"GD",name:"Grenada"},{value:"GP",name:"Guadeloupe"},{value:"GU",name:"Guam"},{value:"GT",name:"Guatemala"},{value:"GG",name:"Guernsey"},{value:"GN",name:"Guinea"},{value:"GW",name:"Guinea-Bissau"},{value:"GY",name:"Guyana"},{value:"HT",name:"Haiti"},{value:"HM",name:"Heard Island and Mcdonald Islands"},{value:"VA",name:"Holy See (Vatican City State)"},{value:"HN",name:"Honduras"},{value:"HU",name:"Hungary"},{value:"IS",name:"Iceland"},{value:"IN",name:"India"},{value:"ID",name:"Indonesia"},{value:"IR",name:"Iran, Islamic Republic of"},{value:"IQ",name:"Iraq"},{value:"IE",name:"Ireland"},{value:"IM",name:"Isle of Man"},{value:"IL",name:"Israel"},{value:"IT",name:"Italy"},{value:"JM",name:"Jamaica"},{value:"JP",name:"Japan"},{value:"JE",name:"Jersey"},{value:"JO",name:"Jordan"},{value:"KZ",name:"Kazakhstan"},{value:"KE",name:"Kenya"},{value:"KI",name:"Kiribati"},{value:"KP",name:"Korea, Democratic People's Republic of"},{value:"KR",name:"Korea, Republic of"},{value:"KW",name:"Kuwait"},{value:"KG",name:"Kyrgyzstan"},{value:"LA",name:"Lao PDR"},{value:"LV",name:"Latvia"},{value:"LB",name:"Lebanon"},{value:"LS",name:"Lesotho"},{value:"LR",name:"Liberia"},{value:"LY",name:"Libya"},{value:"LI",name:"Liechtenstein"},{value:"LT",name:"Lithuania"},{value:"LU",name:"Luxembourg"},{value:"MK",name:"Macedonia, Republic of"},{value:"MG",name:"Madagascar"},{value:"MW",name:"Malawi"},{value:"MY",name:"Malaysia"},{value:"MV",name:"Maldives"},{value:"ML",name:"Mali"},{value:"MT",name:"Malta"},{value:"MH",name:"Marshall Islands"},{value:"MQ",name:"Martinique"},{value:"MR",name:"Mauritania"},{value:"MU",name:"Mauritius"},{value:"YT",name:"Mayotte"},{value:"MX",name:"Mexico"},{value:"FM",name:"Micronesia, Federated States of"},{value:"MD",name:"Moldova"},{value:"MC",name:"Monaco"},{value:"MN",name:"Mongolia"},{value:"ME",name:"Montenegro"},{value:"MS",name:"Montserrat"},{value:"MA",name:"Morocco"},{value:"MZ",name:"Mozambique"},{value:"MM",name:"Myanmar"},{value:"NA",name:"Namibia"},{value:"NR",name:"Nauru"},{value:"NP",name:"Nepal"},{value:"NL",name:"Netherlands"},{value:"AN",name:"Netherlands Antilles"},{value:"NC",name:"New Caledonia"},{value:"NZ",name:"New Zealand"},{value:"NI",name:"Nicaragua"},{value:"NE",name:"Niger"},{value:"NG",name:"Nigeria"},{value:"NU",name:"Niue"},{value:"NF",name:"Norfolk Island"},{value:"MP",name:"Northern Mariana Islands"},{value:"NO",name:"Norway"},{value:"OM",name:"Oman"},{value:"PK",name:"Pakistan"},{value:"PW",name:"Palau"},{value:"PS",name:"Palestinian Territory, Occupied"},{value:"PA",name:"Panama"},{value:"PG",name:"Papua New Guinea"},{value:"PY",name:"Paraguay"},{value:"PE",name:"Peru"},{value:"PH",name:"Philippines"},{value:"PN",name:"Pitcairn"},{value:"PL",name:"Poland"},{value:"PT",name:"Portugal"},{value:"PR",name:"Puerto Rico"},{value:"QA",name:"Qatar"},{value:"RE",name:"Réunion"},{value:"RO",name:"Romania"},{value:"RU",name:"Russian Federation"},{value:"RW",name:"Rwanda"},{value:"BL",name:"Saint-Barthélemy"},{value:"SH",name:"Saint Helena"},{value:"KN",name:"Saint Kitts and Nevis"},{value:"LC",name:"Saint Lucia"},{value:"MF",name:"Saint-Martin (French part)"},{value:"PM",name:"Saint Pierre and Miquelon"},{value:"VC",name:"Saint Vincent and Grenadines"},{value:"WS",name:"Samoa"},{value:"SM",name:"San Marino"},{value:"ST",name:"Sao Tome and Principe"},{value:"SA",name:"Saudi Arabia"},{value:"SN",name:"Senegal"},{value:"RS",name:"Serbia"},{value:"SC",name:"Seychelles"},{value:"SL",name:"Sierra Leone"},{value:"SG",name:"Singapore"},{value:"SX",name:"Sint Maarten (Dutch part)"},{value:"SK",name:"Slovakia"},{value:"SI",name:"Slovenia"},{value:"SB",name:"Solomon Islands"},{value:"SO",name:"Somalia"},{value:"ZA",name:"South Africa"},{value:"GS",name:"South Georgia and the South Sandwich Islands"},{value:"SS",name:"South Sudan"},{value:"ES",name:"Spain"},{value:"LK",name:"Sri Lanka"},{value:"SD",name:"Sudan"},{value:"SR",name:"Suriname *"},{value:"SJ",name:"Svalbard and Jan Mayen Islands"},{value:"SZ",name:"Swaziland"},{value:"SE",name:"Sweden"},{value:"CH",name:"Switzerland"},{value:"SY",name:"Syrian Arab Republic (Syria)"},{value:"TW",name:"Taiwan"},{value:"TJ",name:"Tajikistan"},{value:"TZ",name:"Tanzania *, United Republic of"},{value:"TH",name:"Thailand"},{value:"TL",name:"Timor-Leste"},{value:"TG",name:"Togo"},{value:"TK",name:"Tokelau"},{value:"TO",name:"Tonga"},{value:"TT",name:"Trinidad and Tobago"},{value:"TN",name:"Tunisia"},{value:"TR",name:"Turkey"},{value:"TM",name:"Turkmenistan"},{value:"TC",name:"Turks and Caicos Islands"},{value:"TV",name:"Tuvalu"},{value:"UG",name:"Uganda"},{value:"UA",name:"Ukraine"},{value:"AE",name:"United Arab Emirates"},{value:"GB",name:"United Kingdom"},{value:"US",name:"United States of America"},{value:"UM",name:"United States Minor Outlying Islands"},{value:"UY",name:"Uruguay"},{value:"UZ",name:"Uzbekistan"},{value:"VU",name:"Vanuatu"},{value:"VE",name:"Venezuela (Bolivarian Republic of)"},{value:"VN",name:"Viet Nam"},{value:"VI",name:"Virgin Islands, US"},{value:"WF",name:"Wallis and Futuna Islands"},{value:"EH",name:"Western Sahara"},{value:"YE",name:"Yemen"},{value:"ZM",name:"Zambia"},{value:"ZW",name:"Zimbabwe"}];function B(e,a,t){const i=e.session.appeal.application;return!i.isAppealLate||i.lateAppeal&&i.lateAppeal.reason?t():a.redirect(T.homeOffice.appealLate)}var _,$=t(4);function W(e,a,t,i){const o=i||"";return{key:{text:e},value:{html:a.filter(e=>""!==e||void 0).join(o)},actions:{items:[t?{href:t,text:v.common.links.change}:null]}}}function G(e,a,t){const i=t||"";return{key:{text:e},value:{html:a.filter(e=>""!==e||void 0).join(i)}}}!function(e){e.SPACE=" ",e.BREAK_LINE="<br>"}(_||(_={}));var K=t(2),z=t.n(K);const V=new RegExp(/([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\s?[0-9][A-Za-z]{2})/),J=(new RegExp("^(?:07|\\+?447)(?:\\d\\s?){9}$"),t(47));function Z(e,a){return{key:e,text:a,href:`#${e}`}}function Q(e,a,t=!1){const i=a.validate(e,{abortEarly:t});return i.error?i.error.details.reduce((e,a)=>{const t=a.context.key||(a.context.peers?a.context.peers.join("-"):a.context.peers),i=a.context.key||(a.context.peers?a.context.peers[0]:a.context.peers);return e[t]={key:t,text:a.message,href:`#${i}`},e},{}):null}function X(e,a){return Q({[a]:e},z.a.object({[a]:z.a.string().required().trim().messages({"any.required":v.validationErrors.emptyReasonAppealIsLate,"string.empty":v.validationErrors.emptyReasonAppealIsLate})}))}function ee(e){return function(e,a){const{year:t,month:i,day:o}=e,n=H()(`${t} ${i} ${o}`,"YYYY MM DD").isValid()?H()(`${t} ${i} ${o}`,"YYYY MM DD").format("YYYY MM DD"):"invalid Date",s=new Date,r=new Date(s);r.setFullYear(r.getFullYear()-18);const l={...e,date:n},u=z.a.object({date:z.a.date().less("now").max(r).messages({"date.less":a.inPast,"date.max":a.underAge,"date.base":a.incorrectFormat})}).unknown(!0);return Q(l,u,!0)}(e,v.validationErrors.dateOfBirth)||ae(e,v.validationErrors.dateOfBirth)}function ae(e,a){const{year:t,month:i,day:o}=e,n=H()(`${t} ${i} ${o}`,"YYYY MM DD").isValid()?H()(`${t} ${i} ${o}`,"YYYY MM DD").format("YYYY MM DD"):"invalid Date";return Q({...e,date:n},z.a.object({day:z.a.number().empty("").required().integer().min(1).max(31).messages({"any.required":a.missing,"number.base":a.incorrectFormat,"number.integer":a.incorrectFormat,"number.min":a.incorrectFormat,"number.max":a.incorrectFormat}),month:z.a.number().empty("").required().integer().min(1).max(12).required().messages({"any.required":a.missing,"number.base":a.incorrectFormat,"number.integer":a.incorrectFormat,"number.min":a.incorrectFormat,"number.max":a.incorrectFormat}),year:z.a.number().empty("").required().integer().min(1900).required().messages({"any.required":a.missing,"number.base":a.incorrectFormat,"number.integer":a.incorrectFormat,"number.min":a.incorrectFormat}),date:z.a.date().less("now").messages({"date.less":a.inPast,"date.base":a.incorrectFormat})}).unknown(!0),!0)}function te(e,a){return Q(e,z.a.object({answer:z.a.string().required().messages({"any.required":a})}).unknown())}function ie(e){const a=e.appealType.split(",").map(e=>v.appealTypes[e].name),t=U.find(a=>a.value===e.personalDetails.nationality),i=[W(v.pages.checkYourAnswers.rowTitles.homeOfficeRefNumber,[e.homeOfficeRefNumber],T.homeOffice.details+"?edit"),W(v.pages.checkYourAnswers.rowTitles.dateLetterSent,[e.dateLetterSent.day,H.a.months(e.dateLetterSent.month-1),e.dateLetterSent.year],T.homeOffice.letterSent+"?edit",_.SPACE),W(v.pages.checkYourAnswers.rowTitles.name,[e.personalDetails.givenNames,e.personalDetails.familyName],T.personalDetails.name+"?edit",_.SPACE),W(v.pages.checkYourAnswers.rowTitles.dob,[e.personalDetails.dob.day,H.a.months(e.personalDetails.dob.month-1),e.personalDetails.dob.year],T.personalDetails.dob+"?edit",_.SPACE),W(v.pages.checkYourAnswers.rowTitles.nationality,[t.name],T.personalDetails.nationality+"?edit"),W(v.pages.checkYourAnswers.rowTitles.addressDetails,[...Object.values(e.personalDetails.address)],T.personalDetails.enterAddress+"?edit",_.BREAK_LINE),W(v.pages.checkYourAnswers.rowTitles.contactDetails,[e.contactDetails.email,e.contactDetails.phone],T.contactDetails+"?edit",_.BREAK_LINE),W(v.pages.checkYourAnswers.rowTitles.appealType,[a],T.typeOfAppeal+"?edit")];if(e.isAppealLate){const a=[e.lateAppeal.reason];if(e.lateAppeal.evidence){const t={evidence:e.lateAppeal.evidence.name,evidenceUrl:"#"};a.push(v.pages.checkYourAnswers.rowTitles.supportingEvidence),a.push(w.renderString(v.pages.checkYourAnswers.supportingEvidence,t))}const t=W(v.pages.checkYourAnswers.rowTitles.appealLate,a,T.homeOffice.appealLate);i.push(t)}return i}function oe(e,a,t){try{const{application:t}=e.session.appeal,i=ie(t);return a.render("appeal-application/check-and-send.njk",{summaryRows:i,previousPage:T.taskList})}catch(e){t(e)}}function ne(e){return async(a,t,i)=>{const o=a.body;try{const{application:i}=a.session.appeal,n=ie(i),s=function(e){return Q(e,z.a.object({statement:z.a.required().messages({"any.required":v.validationErrors.acceptanceStatement})}).unknown())}(o);if(s)return t.render("appeal-application/check-and-send.njk",{summaryRows:n,error:s,errorList:Object.values(s),previousPage:T.taskList});const r=await e.submitEvent($.b.SUBMIT_APPEAL,a);return a.session.appeal.appealStatus=r.state,t.redirect(T.confirmation)}catch(e){i(e)}}}const se=e=>{return H()().add(e,"days").format("DD MMMM YYYY")};function re(e,a,t){try{const{application:t}=e.session.appeal,i=()=>t.isAppealLate;a.render("confirmation-page.njk",{date:se(14),late:i()})}catch(e){t(e)}}function le(e,...a){return!e.saveForLater||e.saveForLater&&a.some(a=>e[a]&&""!==e[a])}function ue(e,a){return e.saveForLater?T.overview+"?saved":a}const ce=g.a.get("node.port");function pe(e,a,t){return e+"://"+a+("localhost"===a?":"+ce:"")+t}function de(e,a,t){return y.has(e.session,"appeal.application.isEdit")&&!0===e.session.appeal.application.isEdit?(e.session.appeal.application.isEdit=!1,a.redirect(T.checkAndSend)):y.has(e.session,"appeal.reasonsForAppeal.isEdit")&&!0===e.session.appeal.reasonsForAppeal.isEdit?(e.session.appeal.reasonsForAppeal.isEdit=!1,a.redirect(T.reasonsForAppeal.checkAndSend)):a.redirect(t)}function me(e,a,t){try{e.session.appeal.application.isEdit=b.a.has(e.query,"edit");const{application:t}=e.session.appeal,i=t&&t.contactDetails||null;return a.render("appeal-application/contact-details.njk",{contactDetails:i,previousPage:T.taskList})}catch(e){t(e)}}function he(e){return async(a,t,i)=>{try{if(!le(a.body,"selections"))return de(a,t,T.overview+"?saved");a.body.selections||(a.body.selections="");let i=null,o=!1,n=null,s=!1;a.body.selections.includes("email")&&(i=a.body["email-value"],i&&i.length>0&&(o=!0)),a.body.selections.includes("text-message")&&(a.body["text-message-value"]=a.body["text-message-value"].replace(/\s/g,""),n=a.body["text-message-value"],n&&(s=!0));const r={email:i,wantsEmail:o,phone:n,wantsSms:s},l=function(e){return Q(e,z.a.object({selections:z.a.string().required().messages({"string.empty":v.validationErrors.contactDetails.selectOneOption}),"email-value":z.a.alternatives().conditional("selections",{is:z.a.string().regex(/email/),then:z.a.string().required().messages({"any.required":v.validationErrors.emailEmpty}).email({minDomainSegments:2,allowUnicode:!1}).messages({"string.empty":v.validationErrors.emailEmpty,"string.email":v.validationErrors.emailFormat}),otherwise:z.a.any()}),"text-message-value":z.a.alternatives().conditional("selections",{is:z.a.string().regex(/text-message/),then:z.a.extend(J).mobilePhoneNumber().format("e164").messages({"string.empty":v.validationErrors.phoneEmpty,"string.mobilePhoneNumber.invalid.string":v.validationErrors.phoneFormat,"string.mobilePhoneNumber.invalid.mobile":v.validationErrors.phoneFormat}),otherwise:z.a.any()})}).unknown())}(a.body);return l?t.render("appeal-application/contact-details.njk",{contactDetails:r,errors:l,errorList:Object.values(l),previousPage:T.taskList}):(a.session.appeal.application.contactDetails=r,await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,T.taskList))}catch(e){i(e)}}}function ve(e,a,t){try{e.session.appeal.application.isEdit=b.a.has(e.query,"edit");const{homeOfficeRefNumber:t}=e.session.appeal.application||null;a.render("appeal-application/home-office/details.njk",{homeOfficeRefNumber:t,previousPage:T.taskList})}catch(e){t(e)}}function fe(e){return async(a,t,i)=>{try{if(!le(a.body,"homeOfficeRefNumber"))return de(a,t,T.overview);const i=function(e){return Q(e,z.a.object({homeOfficeRefNumber:z.a.string().required().regex(/^[A-Za-z][0-9]{6}[0-9]?(|\/[0-9][0-9]?[0-9]?)$/).messages({"string.empty":v.validationErrors.homeOfficeReference.required,"string.pattern.base":v.validationErrors.homeOfficeReference.invalid})}).unknown())}(a.body);return i?t.render("appeal-application/home-office/details.njk",{errors:i,errorList:Object.values(i),homeOfficeRefNumber:a.body.homeOfficeRefNumber,previousPage:T.taskList}):(a.session.appeal.application.homeOfficeRefNumber=a.body.homeOfficeRefNumber,await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,ue(a.body,T.homeOffice.letterSent)))}catch(e){i(e)}}}function ge(e,a,t){try{e.session.appeal.application.isEdit=b.a.has(e.query,"edit");const{dateLetterSent:t}=e.session.appeal.application;a.render("appeal-application/home-office/letter-sent.njk",{dateLetterSent:t,previousPage:T.homeOffice.details})}catch(e){t(e)}}function ye(e){return async(a,t,i)=>{try{if(!le(a.body,"day","month","year"))return de(a,t,T.overview+"?saved");const i=function(e){return ae(e,v.validationErrors.dateLetterSent)}(a.body);if(i)return t.render("appeal-application/home-office/letter-sent.njk",{error:i,errorList:Object.values(i),dateLetterSent:{...a.body},previousPage:T.homeOffice.details});const{day:o,month:n,year:s}=a.body,r=H()().diff(H()(`${s} ${n} ${o}`,"YYYY MM DD"),"days");return a.session.appeal.application.dateLetterSent={day:o,month:n,year:s},a.session.appeal.application.isAppealLate=!(r<=14),await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,T.taskList)}catch(e){i(e)}}}const be=t(48),we=t(5).get("evidenceUpload.maxFileSizeInMb"),ke=[".jpg",".jpeg",".bmp",".tif",".tiff",".png",".pdf",".txt",".doc",".dot",".docx",".dotx",".xls",".xlt",".xla",".xlsx",".xltx",".xlsb",".ppt",".pot",".pps",".ppa",".pptx",".potx",".ppsx",".rtf",".csv"],Ae=be({limits:{fileSize:1024*we*1024},fileFilter:(e,a,t)=>{ke.includes(k.extname(a.originalname.toLowerCase()))?t(null,!0):t(new be.MulterError("LIMIT_FILE_TYPE"),!1)}}).single("file-upload");function Te(e,a,t,i){let o;if(e instanceof be.MulterError){if("LIMIT_FILE_SIZE"===e.code)o=`${v.validationErrors.fileUpload.fileTooLarge} ${we}MB`;else if("LIMIT_FILE_TYPE"===e.code){const e=ke.join(", ");o=`${v.validationErrors.fileUpload.incorrectFormat} ${e}`}else o=v.validationErrors.fileUpload.fileCannotBeUploaded;return t.locals.multerError=o,i()}return i(e)}function Se(e,a,t){try{const{application:t}=e.session.appeal,i=t.lateAppeal&&t.lateAppeal.reason||null,o=t.lateAppeal&&t.lateAppeal.evidence||null;a.render("appeal-application/home-office/appeal-late.njk",{appealLateReason:i,evidence:o,evidenceCTA:T.homeOffice.deleteEvidence,previousPage:T.taskList})}catch(e){t(e)}}function Ee(e){let a="";return e.buildingNumber&&(a+=e.buildingNumber+" "),a+=[e.dependentThoroughfareName,e.thoroughfareName].filter(Boolean).join(", "),a}function De(e){return e.buildingName&&e.subBuildingName?`${e.subBuildingName} ${e.buildingName}`:[e.subBuildingName,e.buildingName,Ee(e)].filter(Boolean).join(", ")}function Oe(e){return e.buildingName&&e.subBuildingName?[Ee(e),e.doubleDependentLocality,e.dependentLocality].filter(Boolean).join(", "):[e.doubleDependentLocality,e.dependentLocality].filter(Boolean).join(", ")}function xe(e,a,t){const i=e.map(e=>{const t=a===e.value;return{text:e.name,value:e.value,selected:t}});return i.unshift({text:t,value:"",selected:!1}),i}function Pe(e,a,t){try{e.session.appeal.application.isEdit=y.has(e.query,"edit");const{application:t}=e.session.appeal,i=t.personalDetails&&t.personalDetails.dob||null;return a.render("appeal-application/personal-details/date-of-birth.njk",{dob:i,previousPage:T.personalDetails.name})}catch(e){t(e)}}function Fe(e,a,t){try{e.session.appeal.application.isEdit=y.has(e.query,"edit");const t=e.session.appeal.application.personalDetails;return a.render("appeal-application/personal-details/name.njk",{personalDetails:t,previousPage:T.taskList})}catch(e){t(e)}}function Le(e){return async function(a,t,i){try{if(!le(a.body,"day","month","year"))return de(a,t,T.overview+"?saved");const i=Q(a.body,z.a.object({givenNames:z.a.string().required().messages({"string.empty":v.validationErrors.givenNames}),familyName:z.a.string().required().messages({"string.empty":v.validationErrors.familyName})}).unknown());if(i)return t.render("appeal-application/personal-details/name.njk",{personalDetails:{familyName:a.body.familyName,givenNames:a.body.givenNames},error:i,errorList:Object.values(i),previousPage:T.taskList});const{application:o}=a.session.appeal;return o.personalDetails={...o.personalDetails,familyName:a.body.familyName,givenNames:a.body.givenNames},await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,ue(a.body,T.personalDetails.dob))}catch(e){i(e)}}}function Ne(e,a,t){try{e.session.previousPage=T.personalDetails.nationality,e.session.appeal.application.isEdit=y.has(e.query,"edit");const{application:t}=e.session.appeal,i=t.personalDetails&&t.personalDetails.nationality||null,o=xe(U,i,v.pages.nationality.defaultNationality);return a.render("appeal-application/personal-details/nationality.njk",{nationalitiesOptions:o,previousPage:T.personalDetails.dob})}catch(e){t(e)}}function Ce(e){return async function(a,t,i){try{if(!le(a.body,"nationality"))return de(a,t,T.overview+"?saved");const i=Q(a.body,z.a.object({nationality:z.a.string().required().empty("").messages({"any.required":v.validationErrors.nationality.selectNationality})}).unknown(!0));if(i){const e=a.body.nationality,o=xe(U,e,v.pages.nationality.defaultNationality);return t.render("appeal-application/personal-details/nationality.njk",{nationalitiesOptions:o,errors:i,errorList:Object.values(i),previousPage:T.personalDetails.dob})}const{application:o}=a.session.appeal;return o.personalDetails={...o.personalDetails,nationality:a.body.nationality},await e.submitEvent($.b.EDIT_APPEAL,a),y.has(o,"personalDetails.address.line1")?de(a,t,T.personalDetails.enterAddress):de(a,t,ue(a.body,T.personalDetails.enterPostcode))}catch(e){i(e)}}}function Ie(e,a,t){try{e.session.previousPage=T.personalDetails.enterPostcode,y.set(e.session.appeal.application,"addressLookup",{});const{personalDetails:t}=e.session.appeal.application,i=t&&t.address&&t.address.postcode||null;a.render("appeal-application/personal-details/enter-postcode.njk",{postcode:i,previousPage:T.personalDetails.nationality})}catch(e){t(e)}}function Re(e,a,t){try{const t=Q(e.body,z.a.object({postcode:z.a.string().regex(V).messages({"string.empty":v.validationErrors.postcode.empty,"string.pattern.base":v.validationErrors.postcode.invalid})}).unknown());return null!==t?a.render("appeal-application/personal-details/enter-postcode.njk",{error:t,errorList:Object.values(t),postcode:e.body.postcode,previousPage:T.personalDetails.nationality}):(e.session.appeal.application.personalDetails.address={postcode:e.body.postcode},a.redirect(T.personalDetails.postcodeLookup))}catch(e){t(e)}}function je(e){const a=e.addresses.map(e=>({value:e.udprn,text:e.formattedAddress}));return[{value:"",text:1===a.length?v.pages.postcodeLookup.addressFound:`${a.length} ${v.pages.postcodeLookup.addressesFound}`}].concat(a)}function Ye(e,a,t){try{const t=(n=e.body.address,Q({[s="address"]:n},z.a.object({[s]:z.a.string().required().messages({"any.required":v.validationErrors.address.required,"string.empty":v.validationErrors.address.required})})));if(t){const i=je(y.get(e.session.appeal.application,"addressLookup.result"));return a.render("appeal-application/personal-details/postcode-lookup.njk",{error:t,errorList:Object.values(t),addresses:i,previousPage:T.personalDetails.enterPostcode})}const r=function(e,a){return e?{line1:De(e),line2:Oe(e),city:e.postTown,postcode:e.postcode,county:""}:{line1:"",line2:"",city:"",postcode:a||"",county:""}}((i=e.body.address,o=y.get(e.session.appeal.application,"addressLookup.result.addresses"),i&&o?o.find(e=>e.udprn===i):null),y.get(e.session.appeal.application,"personalDetails.address.postcode"));return e.session.appeal.application.personalDetails.address={...r},a.redirect(T.personalDetails.enterAddress)}catch(e){t(e)}var i,o,n,s}function Me(e,a,t){try{e.session.appeal.application.isEdit=y.has(e.query,"edit");const t=y.get(e.session.appeal.application,"personalDetails.address"),i=e.session.previousPage?e.session.previousPage:T.personalDetails.nationality;a.render("appeal-application/personal-details/enter-address.njk",{address:t,previousPage:i})}catch(e){t(e)}}function qe(e){return async(a,t,i)=>{try{if(!le(a.body,"address-line-1","address-line-2","address-town","address-county","address-postcode"))return de(a,t,T.overview+"?saved");const i=function(e){return Q(e,z.a.object({"address-line-1":z.a.string().required().messages({"string.empty":v.validationErrors.address.line1Required}),"address-town":z.a.string().required().messages({"string.empty":v.validationErrors.address.townCityRequired}),"address-county":z.a.string().optional().empty(""),"address-line-2":z.a.string().optional().empty(""),"address-postcode":z.a.string().optional().empty("").regex(V).messages({"string.pattern.base":v.validationErrors.postcode.invalid})}).unknown())}(a.body);if(null!==i){const e=a.session.previousPage?a.session.previousPage:T.personalDetails.nationality;return t.render("appeal-application/personal-details/enter-address.njk",{address:{line1:a.body["address-line-1"],line2:a.body["address-line-2"],city:a.body["address-town"],county:a.body["address-county"],postcode:a.body["address-postcode"]},error:i,errorList:Object.values(i),previousPage:e})}return a.session.appeal.application.personalDetails={...a.session.appeal.application.personalDetails,address:{line1:a.body["address-line-1"],line2:a.body["address-line-2"],city:a.body["address-town"],county:a.body["address-county"],postcode:a.body["address-postcode"]}},await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,T.taskList)}catch(e){i(e)}}}class He{constructor(e,a){this.idamService=e,this.s2sService=a}async getSecurityHeaders(e){return{userToken:this.idamService.getUserToken(e),serviceToken:await this.s2sService.getServiceToken()}}}class Ue{getUserToken(e){return`Bearer ${e.cookies["__auth-token"]}`}}var Be,_e;!function(e){e.APPELLANT="appellant",e.SUPPORTER="supporter"}(Be||(Be={})),function(e){e.YES="Yes",e.NO="No"}(_e||(_e={}));class $e{constructor(e,a){this._ccdService=e,this._authenticationService=a}getCcdService(){return this._ccdService}getAuthenticationService(){return this._authenticationService}async loadAppeal(e){const a=await this._authenticationService.getSecurityHeaders(e),t=await this._ccdService.loadOrCreateCase(e.idam.userDetails.uid,a);e.session.ccdCaseId=t.id;const i=t.case_data,o=this.getDate(i.homeOfficeDecisionDate),n=this.getDate(i.appellantDateOfBirth),s=i.appellantAddress?{line1:i.appellantAddress.AddressLine1,line2:i.appellantAddress.AddressLine2,city:i.appellantAddress.PostTown,county:i.appellantAddress.County,postcode:i.appellantAddress.PostCode}:null,r=i.appealType||null;let l=null;const u=(i.subscriptions||[]).reduce((e,a)=>{const t=a.value;if(Be.APPELLANT===t.subscriber)return{email:t.email||null,wantsEmail:_e.YES===t.wantsEmail,phone:t.mobileNumber||null,wantsSms:_e.YES===t.wantsSms}},{})||{email:null,wantsEmail:!1,phone:null,wantsSms:!1};this.yesNoToBool(i.submissionOutOfTime)&&(i.applicationOutOfTimeExplanation&&(l={reason:i.applicationOutOfTimeExplanation}),i.applicationOutOfTimeDocument&&i.applicationOutOfTimeDocument.document_filename&&(l={...l,evidence:{id:i.applicationOutOfTimeDocument.document_filename,url:i.applicationOutOfTimeDocument.document_url,name:this.fileIdToName(i.applicationOutOfTimeDocument.document_filename)}})),e.session.appeal={appealStatus:t.state,appealCreatedDate:t.created_date,appealLastModified:t.last_modified,application:{homeOfficeRefNumber:i.homeOfficeReferenceNumber,appealType:r,contactDetails:{...u},dateLetterSent:o,isAppealLate:i.submissionOutOfTime?this.yesNoToBool(i.submissionOutOfTime):void 0,lateAppeal:l||void 0,personalDetails:{givenNames:i.appellantGivenNames,familyName:i.appellantFamilyName,dob:n,nationality:i.appellantNationalities?i.appellantNationalities[0].value.code:null,address:s},addressLookup:{}},reasonsForAppeal:{applicationReason:null},hearingRequirements:{}}}getDate(e){if(e){let a={year:null,month:null,day:null};const t=new Date(e);return a={year:t.getFullYear().toString(),month:(t.getMonth()+1).toString(),day:t.getDate().toString()},a}return null}yesNoToBool(e){return"Yes"===e||"No"!==e&&void 0}fileIdToName(e){return e.substring(e.indexOf("-")+1)}async submitEvent(e,a){const t=await this._authenticationService.getSecurityHeaders(a),i=a.idam.userDetails.uid,o=this.convertToCcdCaseData(a.session.appeal),n={id:a.session.ccdCaseId,state:a.session.appeal.appealStatus,case_data:o};return await this._ccdService.updateAppeal(e,i,n,t)}convertToCcdCaseData(e){const a={journeyType:"aip"};if(y.has(e,"application")&&(e.application.homeOfficeRefNumber&&(a.homeOfficeReferenceNumber=e.application.homeOfficeRefNumber),e.application.dateLetterSent&&e.application.dateLetterSent.year&&(a.homeOfficeDecisionDate=this.toIsoDate(e.application.dateLetterSent),a.submissionOutOfTime=e.application.isAppealLate?_e.YES:_e.NO),y.has(e.application.lateAppeal,"reason")&&(a.applicationOutOfTimeExplanation=e.application.lateAppeal.reason),y.has(e.application.lateAppeal,"evidence")&&(a.applicationOutOfTimeDocument={document_filename:e.application.lateAppeal.evidence.id,document_url:e.application.lateAppeal.evidence.url,document_binary_url:`${e.application.lateAppeal.evidence.url}/binary`}),e.application.personalDetails&&e.application.personalDetails.givenNames&&(a.appellantGivenNames=e.application.personalDetails.givenNames),e.application.personalDetails&&e.application.personalDetails.familyName&&(a.appellantFamilyName=e.application.personalDetails.familyName),e.application.personalDetails.dob&&e.application.personalDetails.dob.year&&(a.appellantDateOfBirth=this.toIsoDate(e.application.personalDetails.dob)),e.application.personalDetails&&e.application.personalDetails.nationality&&(a.appellantNationalities=[{value:{code:e.application.personalDetails.nationality}}]),y.has(e.application.personalDetails,"address.line1")&&(a.appellantAddress={AddressLine1:e.application.personalDetails.address.line1,AddressLine2:e.application.personalDetails.address.line2,PostTown:e.application.personalDetails.address.city,County:e.application.personalDetails.address.county,PostCode:e.application.personalDetails.address.postcode,Country:"United Kingdom"},a.appellantHasFixedAddress="Yes"),e.application.appealType&&(a.appealType=e.application.appealType),e.application.contactDetails&&(e.application.contactDetails.email||e.application.contactDetails.phone))){const t={subscriber:Be.APPELLANT,wantsEmail:_e.NO,email:null,wantsSms:_e.NO,mobileNumber:null};!0===e.application.contactDetails.wantsEmail&&e.application.contactDetails.email&&(t.wantsEmail=_e.YES,t.email=e.application.contactDetails.email),!0===e.application.contactDetails.wantsSms&&e.application.contactDetails.phone&&(t.wantsSms=_e.YES,t.mobileNumber=e.application.contactDetails.phone),a.subscriptions=[{value:t}]}if(y.has(e,"reasonsForAppeal")&&(e.reasonsForAppeal.applicationReason&&(a.reasonsForAppealDecision=e.reasonsForAppeal.applicationReason),e.reasonsForAppeal.evidences)){const t=e.reasonsForAppeal.evidences;a.reasonsForAppealDocuments=Object.values(t).map(e=>({value:{document_filename:e.id,document_url:e.url,document_binary_url:`${e.url}/binary`}}))}return a}toIsoDate(e){return new Date(`${e.year}-${e.month}-${e.day}`).toISOString().split("T")[0]}}function We(e){const a=!!y.get(e.application,"homeOfficeRefNumber"),t=!!y.get(e.application,"dateLetterSent"),i={saved:a||t,completed:a&&t,active:!0},o=!!y.get(e.application,"personalDetails.givenNames"),n=!!y.get(e.application,"personalDetails.familyName"),s=!!y.get(e.application,"personalDetails.dob"),r=!!y.get(e.application,"personalDetails.nationality"),l=!!y.get(e.application,"personalDetails.address.postcode"),u=!!y.get(e.application,"personalDetails.address.line1"),c={saved:o||n||s||r||l||u,completed:o&&n&&s&&r&&u,active:i.completed},p=!!y.get(e.application,"contactDetails.email"),d=!!y.get(e.application,"contactDetails.wantsEmail"),m=!!y.get(e.application,"contactDetails.phone"),h=!!y.get(e.application,"contactDetails.wantsSms"),v={saved:p&&d||m&&h,completed:p&&d||m&&h,active:c.completed},f={saved:!!y.get(e.application,"appealType"),completed:!!y.get(e.application,"appealType"),active:v.completed};return{homeOfficeDetails:i,personalDetails:c,contactDetails:v,typeOfAppeal:f,checkAndSend:{saved:!1,completed:!1,active:f.completed}}}const Ge=new He(new Ue,S.a.getInstance()),Ke=new $e(new $.a,Ge);async function ze(e,a,t){try{await Ke.loadAppeal(e),e.session.appeal.application.tasks=We(e.session.appeal),t()}catch(e){t(e)}}function Ve(e,a,t){try{e.session.appeal.application.tasks=We(e.session.appeal),t()}catch(e){t(e)}}function Je(e,a,t){const i=[];return a.forEach(e=>{const a=function(e){return t.session.appeal.application.tasks[e].completed}(e),o={id:e,saved:function(e){return t.session.appeal.application.tasks[e].saved}(e),completed:a,active:function(e){return t.session.appeal.application.tasks[e].active}(e)};i.push(o)}),{sectionId:e,tasks:i}}function Ze(e,a,t){try{const t=function(e){return[Je("yourDetails",["homeOfficeDetails","personalDetails","contactDetails"],e),Je("appealDetails",["typeOfAppeal"],e),Je("checkAndSend",["checkAndSend"],e)]}(e);return a.render("appeal-application/task-list.njk",{data:t})}catch(e){t(e)}}const Qe=[...Object.values(v.appealTypes)];function Xe(e,a,t){try{e.session.appeal.application.isEdit=b.a.has(e.query,"edit");const t=e.session.appeal.application&&e.session.appeal.application.appealType||[],i=Qe.map(e=>(t.includes(e.value)?e.checked=!0:e.checked=!1,e));return a.render("appeal-application/type-of-appeal.njk",{types:i,previousPage:T.taskList})}catch(e){t(e)}}function ea(e){return async(a,t,i)=>{try{if(!le(a.body,"appealType"))return de(a,t,T.overview+"?saved");const i=function(e){return Q(e,z.a.object({appealType:z.a.string().required().messages({"any.required":v.validationErrors.selectAnAppealType})}).unknown())}(a.body);return i?t.render("appeal-application/type-of-appeal.njk",{types:Qe,errors:i,errorList:Object.values(i),previousPage:T.taskList}):(a.session.appeal.application.appealType=a.body.appealType,await e.submitEvent($.b.EDIT_APPEAL,a),de(a,t,T.taskList))}catch(e){i(e)}}}const aa={appealStarted:{descriptionParagraphs:[v.pages.overviewPage.doThisNext.appealStarted.fewQuestions,v.pages.overviewPage.doThisNext.appealStarted.needHomeOfficeDecision],info:{title:null,url:null},cta:T.taskList},appealStartedPartial:{descriptionParagraphs:[v.pages.overviewPage.doThisNext.appealStarted.finishQuestions,v.pages.overviewPage.doThisNext.appealStarted.needHomeOfficeDecision],info:{title:null,url:null},cta:T.taskList},appealSubmitted:{descriptionParagraphs:[v.pages.overviewPage.doThisNext.appealSubmitted.detailsSent,v.pages.overviewPage.doThisNext.appealSubmitted.dueDate],info:{title:v.pages.overviewPage.doThisNext.appealSubmitted.info.title,url:v.pages.overviewPage.doThisNext.appealSubmitted.info.url},cta:null},reasonsForAppealSubmitted:{descriptionParagraphs:[v.pages.overviewPage.doThisNext.reasonsForAppealSubmitted.detailsSent,v.pages.overviewPage.doThisNext.reasonsForAppealSubmitted.dueDate],cta:null}};function ta(e){let a=e.session.appeal.appealStatus;(function(e,a){switch(a){case"appealStarted":return b.a.has(e.session.appeal,"application.homeOfficeRefNumber");case"awaitingReasonsForAppeal":return b.a.has(e.session.appeal,"caseBuilding.decision");default:return!1}})(e,a)&&(a+="Partial");let t=aa[a];void 0===t&&(t={descriptionParagraphs:[`Description for event <span  class='govuk-body govuk-!-font-weight-bold'> ${a}</span>  not found`]});const i={appealStarted:{event:"appealStarted",date:e.session.appeal.appealCreatedDate},appealSubmitted:{event:"appealSubmitted",date:e.session.appeal.appealLastModified}};return t.deadline=function(e,a){switch(e){case"appealStarted":return null;case"appealSubmitted":{const e=14,t=a.appealSubmitted.date;return H()(t).add(e,"days").format("DD MMMM YYYY")||null}}}(a,i),t}async function ia(e,a){const t=a.getAuthenticationService(),i=await t.getSecurityHeaders(e),o=a.getCcdService(),n=await o.getCaseHistory(e.idam.userDetails.uid,e.session.ccdCaseId,i);e.session.appeal.history=n;const s=[];return["submitAppeal","submitReasonsForAppeal"].forEach(e=>{const a=n.find(a=>e===a.id);if(a){const e=function(e){return{date:`${H()(e.date).format("DD MMMM YYYY")}`,title:v.pages.overviewPage.timeline[e.id].title,text:v.pages.overviewPage.timeline[e.id].text,links:v.pages.overviewPage.timeline[e.id].links}}(a);s.push(e)}}),s}function oa(e){return async(a,t,i)=>{try{const i=b.a.has(a.query,"saved"),o=`${a.idam.userDetails.name}`,n=function(e){const a={yourAppealDetails:{activeStatus:["appealStarted","appealSubmitted","awaitingRespondentEvidence"]},yourAppealArgument:{activeStatus:["awaitingReasonsForAppeal"]},yourHearingDetails:{activeStatus:["reasonsForAppealSubmitted"]},yourAppealDecision:{activeStatus:[]}},t={title:v.components.progressBar.yourAppealDetails.title,ariaLabel:v.components.progressBar.yourAppealDetails.ariaLabel,active:a.yourAppealDetails.activeStatus.includes(e),completed:!a.yourAppealDetails.activeStatus.includes(e)},i={title:v.components.progressBar.yourAppealArgument.title,ariaLabel:v.components.progressBar.yourAppealArgument.ariaLabel,active:a.yourAppealArgument.activeStatus.includes(e),completed:t.completed&&!a.yourAppealArgument.activeStatus.includes(e)},o={title:v.components.progressBar.yourHearingDetails.title,ariaLabel:v.components.progressBar.yourHearingDetails.ariaLabel,active:a.yourHearingDetails.activeStatus.includes(e),completed:i.completed&&!a.yourHearingDetails.activeStatus.includes(e)};return[t,i,o,{title:v.components.progressBar.yourAppealDecision.title,ariaLabel:v.components.progressBar.yourAppealDecision.ariaLabel,active:a.yourAppealDecision.activeStatus.includes(e),completed:o.completed&&!a.yourAppealDecision.activeStatus.includes(e)}]}(a.session.appeal.appealStatus),s=await ia(a,e);return t.render("application-overview.njk",{name:o,applicationNextStep:ta(a),history:s,stages:n,saved:i})}catch(e){i(e)}}}const na=(e,a)=>{const t=a.session.appeal.history;let i=[];for(let a=0;a<t.length;a++)if(t[a].id===e)return i.push(t[a]),i},sa=e=>H()(e).format("DD MMMM YYYY");function ra(e,a){return!!a}function la(e){const a=[],t=na("submitAppeal",e),{data:i}=t[0],o=i.appealType.split(",").map(e=>v.appealTypes[e].name);if(ra(0,i.homeOfficeReferenceNumber)&&a.push(G(v.pages.checkYourAnswers.rowTitles.homeOfficeRefNumber,[i.homeOfficeReferenceNumber])),ra(0,i.homeOfficeDecisionDate)&&a.push(G(v.pages.checkYourAnswers.rowTitles.dateLetterSent,[sa(i.homeOfficeDecisionDate)])),ra(0,i.appellantNameForDisplay)&&a.push(G(v.pages.checkYourAnswers.rowTitles.name,[i.appellantNameForDisplay])),ra(0,i.appellantDateOfBirth)&&a.push(G(v.pages.checkYourAnswers.rowTitles.dob,[sa(i.appellantDateOfBirth)])),ra(0,i.appellantNationalities[0].value.code)){const e=U.find(e=>e.value===t[0].data.appellantNationalities[0].value.code).name;a.push(G(v.pages.checkYourAnswers.rowTitles.nationality,[e]))}return ra(0,i.appellantAddress)&&a.push(G(v.pages.checkYourAnswers.rowTitles.addressDetails,[...Object.values(i.appellantAddress)],_.BREAK_LINE)),ra(0,i.subscriptions[0].value)&&a.push(G(v.pages.checkYourAnswers.rowTitles.contactDetails,[i.subscriptions[0].value.email,i.subscriptions[0].value.mobileNumber],_.BREAK_LINE)),ra(0,i.appealType)&&a.push(G(v.pages.checkYourAnswers.rowTitles.appealType,[o])),ra(0,i.applicationOutOfTimeExplanation)&&a.push(G(v.pages.checkYourAnswers.rowTitles.appealLate,[i.applicationOutOfTimeExplanation])),a}function ua(e){const a=[],t=na("submitReasonsForAppeal",e),{data:i}=t[0],o=i.respondentDocuments.map(e=>e.value.document.document_filename);return a.push(G(v.pages.overviewPage.timeline.reasonsForAppealCheckAnswersHistory.whyYouThinkHomeOfficeIsWrong,[i.reasonsForAppealDecision])),ra(0,i.respondentDocuments)&&a.push(G(v.pages.reasonsForAppealUpload.title,[...Object.values(o)],_.BREAK_LINE)),a}function ca(e,a,t){try{let t=T.overview;return a.render("detail-viewers/appeal-details-viewer.njk",{previousPage:t,data:la(e)})}catch(e){t(e)}}function pa(e,a,t){try{let t=T.overview;return a.render("detail-viewers/reasons-for-appeal-details-viewer.njk",{previousPage:t,data:ua(e)})}catch(e){t(e)}}function da(e){return"0"===e?T.start:`${T.eligibility.questions}?id=${y.toNumber(e)-1}`}function ma(e,a){return{question:v.eligibility[e].question,description:v.eligibility[e].description,questionId:e,previousPage:da(e),answer:a,errors:void 0,errorList:void 0}}function ha(e,a,t){try{let t=y.get(e.query,"id","0");e.session.eligibility||(e.session.eligibility={},t="0");const i=y.get(e.session.eligibility,t+".answer","");return a.render("eligibility/eligibility-question.njk",ma(t,i))}catch(e){t(e)}}function va(e,a,t){try{const t=e.body.questionId,i=e.body.answer,o=te(e.body,v.eligibility[t].errorMessage);if(o){const e=ma(t,i);return e.errors=o,e.errorList=Object.values(o),a.render("eligibility/eligibility-question.njk",{question:v.eligibility[t].question,description:v.eligibility[t].description,questionId:t,previousPage:da(t),answer:i,errors:o,errorList:Object.values(o)})}e.session.eligibility||(e.session.eligibility={}),e.session.eligibility[t]={answer:i};let n=y.toNumber(t)+1;const s=n===v.eligibility.length,r=function(e,a){return y.isString(v.eligibility[e].eligibleAnswer)?a===v.eligibility[e].eligibleAnswer:v.eligibility[e].eligibleAnswer.indexOf(a)>-1}(t,i)?s?`${T.eligibility.eligible}?id=${y.toNumber(t)}`:`${T.eligibility.questions}?id=${n}`:`${T.eligibility.ineligible}?id=${y.toNumber(t)}`;return a.redirect(r)}catch(e){t(e)}}function fa(e,a,t){try{if(!e.session.eligibility)return e.session.eligibility={},a.redirect(T.eligibility.questions);a.render("eligibility/eligible-page.njk",{previousPage:`${T.eligibility.questions}?id=${e.query.id}`})}catch(e){t(e)}}function ga(e,a,t){try{a.render("eligibility/ineligible-page.njk",{previousPage:`${T.eligibility.questions}?id=${e.query.id}`})}catch(e){t(e)}}function ya(e,a,t){a.render("footer/cookies.njk",{previousPage:{attributes:{onclick:"history.go(-1); return false;"}}})}function ba(e,a,t){a.render("footer/privacy-policy.njk",{previousPage:{attributes:{onclick:"history.go(-1); return false;"}}})}function wa(e,a,t){a.render("footer/terms-and-conditions.njk",{previousPage:{attributes:{onclick:"history.go(-1); return false;"}}})}const ka=e=>{switch(e){case"caseworker":return v.pages.guidancePages.caseWorker;case"homeOfficeDocuments":return v.pages.guidancePages.homeOfficeDocuments;case"helpWithAppeal":return v.pages.guidancePages.helpWithAppeal;case"evidenceToSupportAppeal":return v.pages.guidancePages.evidenceToSupportAppeal;default:return!1}};function Aa(e,a,t){const i=ka("caseworker");try{return a.render("guidance-pages/guidance-page.njk",{showContactUs:!0,previousPage:"/",page:i})}catch(e){t(e)}}function Ta(e,a,t){const i=ka("helpWithAppeal");try{return a.render("guidance-pages/guidance-page.njk",{showContactUs:!0,previousPage:"/",page:i})}catch(e){t(e)}}function Sa(e,a,t){const i=ka("homeOfficeDocuments");try{return a.render("guidance-pages/guidance-page.njk",{showContactUs:!1,previousPage:"/",page:i})}catch(e){t(e)}}function Ea(e,a,t){const i=ka("evidenceToSupportAppeal");try{return a.render("guidance-pages/guidance-page.njk",{showContactUs:!0,previousPage:"/",page:i})}catch(e){t(e)}}function Da(e,a){a.json({status:"UP"})}function Oa(e,a){a.json({})}var xa=t(13),Pa=t.n(xa),Fa=t(10);const La=Object(Fa.a)(),Na={redirectUri:"https://localhost:3000/redirectUrl",indexUrl:T.login,idamApiUrl:La.get("idam.apiUrl"),idamLoginUrl:`${La.get("idam.webUrl")}/login`,idamSecret:La.get("idam.secret"),idamClientID:La.get("microservice"),openId:!0};function Ca(e,a,t){try{a.redirect(T.overview)}catch(e){t(e)}}function Ia(e,a,t){try{a.redirect(T.start)}catch(e){t(e)}}function Ra(e,a,t){try{a.redirect(T.overview)}catch(e){t(e)}}function ja(e,a,t){Na.redirectUri=function(e){return pe("https",e.hostname,"/redirectUrl")}(e),Pa.a.authenticate(Na)(e,a,t)}function Ya(e,a,t){try{return a.redirect(T.start)}catch(e){t(e)}}function Ma(e,a,t){try{const t="?edit";let i=T.reasonsForAppeal.supportingEvidence;const o=[W(v.common.cya.questionRowTitle,[v.pages.reasonForAppeal.heading],null),W(v.common.cya.answerRowTitle,[e.session.appeal.reasonsForAppeal.applicationReason],T.reasonsForAppeal.decision+t)];if(y.has(e.session.appeal.reasonsForAppeal,"evidences")){const a=e.session.appeal.reasonsForAppeal.evidences,n=Object.values(a).map(e=>e.name);n.length&&(o.push(W(v.common.cya.supportingEvidenceRowTitle,n,T.reasonsForAppeal.supportingEvidenceUpload+t,_.BREAK_LINE)),i=T.reasonsForAppeal.supportingEvidenceUpload)}return a.render("reasons-for-appeal/check-and-send-page.njk",{summaryRows:o,previousPage:i})}catch(e){t(e)}}function qa(e,a,t){try{return e.session.appeal.reasonsForAppeal.isEdit=y.has(e.query,"edit"),a.render("reasons-for-appeal/reason-for-appeal-page.njk",{previousPage:T.caseBuilding.timeline,applicationReason:e.session.appeal.reasonsForAppeal.applicationReason})}catch(e){t(e)}}function Ha(e){return async function(a,t,i){try{const i=Q(a.body,z.a.object({applicationReason:z.a.string().required().messages({"string.empty":v.validationErrors.reasonForAppeal.required})}).unknown());return null!=i?t.render("reasons-for-appeal/reason-for-appeal-page.njk",{errorList:Object.values(i),error:i}):(a.session.appeal.reasonsForAppeal={...a.session.appeal.reasonsForAppeal,applicationReason:a.body.applicationReason},await e.submitEvent($.b.EDIT_REASONS_FOR_APPEAL,a),a.body.saveForLater?(y.has(a.session,"appeal.reasonsForAppeal.isEdit")&&!0===a.session.appeal.reasonsForAppeal.isEdit&&(a.session.appeal.reasonsForAppeal.isEdit=!1),t.redirect(T.caseBuilding.timeline)):de(a,t,T.reasonsForAppeal.supportingEvidence))}catch(e){i(e)}}}function Ua(e,a,t){try{return e.session.appeal.reasonsForAppeal.isEdit=y.has(e.query,"edit"),a.render("reasons-for-appeal/supporting-evidence-page.njk",{previousPage:T.reasonsForAppeal.decision})}catch(e){t(e)}}function Ba(e,a,t){try{const{answer:t}=e.body,i=te(e.body,v.validationErrors.reasonForAppeal.supportingEvidenceRequired);return null!==i?a.render("reasons-for-appeal/supporting-evidence-page.njk",{errorList:Object.values(i),error:i,previousPage:T.reasonsForAppeal.supportingEvidence}):"yes"===t?a.redirect(T.reasonsForAppeal.supportingEvidenceUpload):a.redirect(T.reasonsForAppeal.checkAndSend)}catch(e){t(e)}}function _a(e,a,t){try{e.session.appeal.reasonsForAppeal.isEdit=y.has(e.query,"edit");const t=e.session.appeal.reasonsForAppeal.evidences||{};return a.render("reasons-for-appeal/supporting-evidence-upload-page.njk",{evidences:Object.values(t),evidenceCTA:T.reasonsForAppeal.supportingEvidenceDeleteFile,previousPage:T.reasonsForAppeal.supportingEvidence})}catch(e){t(e)}}function $a(e,a,t){try{return a.render("reasons-for-appeal/confirmation-page.njk",{date:se(14)})}catch(e){t(e)}}function Wa(e,a,t){try{e.session.eligibility={},a.render("start.njk")}catch(e){t(e)}}var Ga=t(33);const Ka=Object(Fa.a)(),za=(Ka.get("session.useLogger"),new He(new Ue,S.a.getInstance())),Va=new $e(new $.a,za),Ja=new Ga.a(za),Za=new j.OSPlacesClient(Ka.get("addressLookup.token"),M.a,Ka.get("addressLookup.url")),Qa=p.Router(),Xa=function(){const e=Object(p.Router)();return e.get(T.index,Ya),e}(),et=function(){const e=Object(p.Router)();return e.get(T.start,Wa),e}(),at=function(){const e=Object(p.Router)();return e.get(T.health,Da),e.get(T.liveness,Oa),e.get(T.healthLiveness,Oa),e}(),tt=function(){const e=Object(p.Router)();return e.use(Pa.a.userDetails(Na)),e.get(T.login,ja,Ca),e.get(T.redirectUrl,Pa.a.landingPage(Na),ze,Ra),e.use(Pa.a.protect(Na),function(e={}){return(a,t,i)=>{const o=e.tokenCookieName||"__auth-token";a.cookies&&a.cookies[o]&&!y.has(a,"session.appeal.application")?(t.clearCookie(o,"/"),t.redirect(T.login)):i()}}(Na)),e.get(T.logout,Pa.a.logout(Na),Ia),e}(),it=function(e){const a=Object(p.Router)();return a.get(T.overview,oa(e)),a}(Va),ot=function(){const e=Object(p.Router)();return e.get(T.taskList,Ve,Ze),e}(),nt=function(){const e=Object(p.Router)();return e.get(T.detailsViewers.appealDetails,ca),e.get(T.detailsViewers.reasonsForAppeal,pa),e}(),st=function(e){const a=Object(p.Router)();return a.get(T.homeOffice.details,ve),a.post(T.homeOffice.details,fe(e)),a.get(T.homeOffice.letterSent,ge),a.post(T.homeOffice.letterSent,ye(e)),a}(Va),rt=function(e){const a=Object(p.Router)();return a.get(T.typeOfAppeal,Xe),a.post(T.typeOfAppeal,ea(e)),a}(Va),lt=function(e){const a=Object(p.Router)();var t,i;return a.get(T.personalDetails.name,Fe),a.post(T.personalDetails.name,Le(e.updateAppealService)),a.get(T.personalDetails.dob,Pe),a.post(T.personalDetails.dob,(t=e.updateAppealService,async function(e,a,i){try{if(!le(e.body,"day","month","year"))return de(e,a,T.overview+"?saved");const i=ee(e.body);return null!=i?a.render("appeal-application/personal-details/date-of-birth.njk",{errors:i,errorList:Object.values(i),dob:{...e.body},previousPage:T.personalDetails.name}):(e.session.appeal.application.personalDetails={...e.session.appeal.application.personalDetails,dob:{day:e.body.day,month:e.body.month,year:e.body.year}},await t.submitEvent($.b.EDIT_APPEAL,e),de(e,a,ue(e.body,T.personalDetails.nationality)))}catch(e){i(e)}})),a.get(T.personalDetails.nationality,Ne),a.post(T.personalDetails.nationality,Ce(e.updateAppealService)),a.get(T.personalDetails.enterPostcode,Ie),a.post(T.personalDetails.enterPostcode,Re),a.get(T.personalDetails.enterAddress,Me),a.post(T.personalDetails.enterAddress,qe(e.updateAppealService)),a.get(T.personalDetails.postcodeLookup,(i=e.osPlacesClient,async(e,a,t)=>{e.session.previousPage=T.personalDetails.postcodeLookup;try{const t=y.get(e.session.appeal.application,"personalDetails.address.postcode");if(!t)return a.redirect(T.personalDetails.enterPostcode);const o=await i.lookupByPostcode(t);e.session.appeal.application.addressLookup.result=o;const n=je(o);a.render("appeal-application/personal-details/postcode-lookup.njk",{addresses:n,postcode:t,previousPage:T.personalDetails.enterPostcode})}catch(e){t(e)}})),a.post(T.personalDetails.postcodeLookup,Ye),a}({updateAppealService:Va,osPlacesClient:Za}),ut=function(e){const a=Object(p.Router)();return a.get(T.contactDetails,me),a.post(T.contactDetails,he(e)),a}(Va),ct=function(e){const a=Object(p.Router)();return a.get(T.checkAndSend,B,oe),a.post(T.checkAndSend,ne(e)),a}(Va),pt=function(){const e=Object(p.Router)();return e.get(T.confirmation,re),e}(),dt=function(e){const a=Object(p.Router)();var t,i;return a.get(T.homeOffice.appealLate,Se),a.post(T.homeOffice.appealLate,Ae,Te,(t=e.documentManagementService,i=e.updateAppealService,async(e,a,o)=>{try{if(!le(e.body,"appeal-late"))return de(e,a,T.overview);const{application:o}=e.session.appeal;let n=X(e.body["appeal-late"],"appeal-late");if(a.locals.multerError&&(n={...n,uploadFile:Z("uploadFile",a.locals.multerError)}),n){let t=null;return y.has(o,"lateAppeal.evidence")&&(t=o.lateAppeal.evidence),a.render("appeal-application/home-office/appeal-late.njk",{appealLateReason:e.body["appeal-late"],evidence:t,error:n,errorList:Object.values(n),previousPage:T.taskList})}if(e.file){y.has(o.lateAppeal,"evidence.url")&&await t.deleteFile(e,o.lateAppeal.evidence.url);const a=await t.uploadFile(e);o.lateAppeal={...o.lateAppeal,evidence:{id:a.id,url:a.url,name:a.name}}}return o.lateAppeal={...o.lateAppeal,reason:e.body["appeal-late"]},await i.submitEvent($.b.EDIT_APPEAL,e),de(e,a,ue(e.body,T.checkAndSend))}catch(e){o(e)}})),a.post(T.homeOffice.deleteEvidence,Ae,Te,function(e,a){return async(t,i,o)=>{try{const o=t.session.appeal.application.lateAppeal.evidence;await e.deleteFile(t,o.url),delete t.session.appeal.application.lateAppeal.evidence;const n=X(t.body["appeal-late"],"appeal-late");return n?i.render("appeal-application/home-office/appeal-late.njk",{appealLateReason:t.body["appeal-late"],error:n,errorList:Object.values(n),previousPage:T.taskList}):(t.session.appeal.application.lateAppeal.reason=t.body["appeal-late"],await a.submitEvent($.b.EDIT_APPEAL,t),i.redirect(T.homeOffice.appealLate))}catch(e){o(e)}}}(e.documentManagementService,e.updateAppealService)),a}({updateAppealService:Va,documentManagementService:Ja}),mt=function(){const e=Object(p.Router)();return e.get(T.eligibility.questions,ha),e.post(T.eligibility.questions,va),e.get(T.eligibility.eligible,fa),e.get(T.eligibility.ineligible,ga),e}(),ht=function(){const e=Object(p.Router)();return e.get(T.tribunalCaseworker,Aa),e.get(T.moreHelp,Ta),e.get(T.homeOfficeDocuments,Sa),e.get(T.evidenceToSupportAppeal,Ea),e}(),vt=function(){const e=Object(p.Router)();return e.get(T.footer.cookies,ya),e.get(T.footer.privacyPolicy,ba),e.get(T.footer.termsAndConditions,wa),e}(),ft=function(e){const a=Object(p.Router)();var t,i;return a.get(T.reasonsForAppeal.decision,qa),a.post(T.reasonsForAppeal.decision,Ha(e.updateAppealService)),a.get(T.reasonsForAppeal.supportingEvidence,Ua),a.post(T.reasonsForAppeal.supportingEvidence,Ba),a.get(T.reasonsForAppeal.supportingEvidenceUpload,_a),a.post(T.reasonsForAppeal.supportingEvidenceUploadFile,Ae,Te,(t=e.documentManagementService,async(e,a,i)=>{try{if(e.file){const i=await t.uploadFile(e),{reasonsForAppeal:o}=e.session.appeal;return o.evidences={...o.evidences,[i.id]:{id:i.id,url:i.url,name:i.name}},a.redirect(T.reasonsForAppeal.supportingEvidenceUpload)}{let e;return e=a.locals.multerError?{uploadFile:Z("uploadFile",a.locals.multerError)}:{uploadFile:Z("uploadFile",v.validationErrors.fileUpload.noFileSelected)},a.render("reasons-for-appeal/supporting-evidence-upload-page.njk",{error:e,errorList:Object.values(e),previousPage:T.reasonsForAppeal.supportingEvidence})}}catch(e){i(e)}})),a.get(T.reasonsForAppeal.supportingEvidenceDeleteFile,function(e){return async(a,t,i)=>{try{if(a.query.id){const t=a.query.id,i=a.session.appeal.reasonsForAppeal.evidences[t];await e.deleteFile(a,i.url),delete a.session.appeal.reasonsForAppeal.evidences[t]}return t.redirect(T.reasonsForAppeal.supportingEvidenceUpload)}catch(e){i(e)}}}(e.documentManagementService)),a.post(T.reasonsForAppeal.supportingEvidenceSubmit,(i=e.updateAppealService,async function(e,a,t){try{if(e.body.saveForLater)return y.has(e.session,"appeal.reasonsForAppeal.isEdit")&&!0===e.session.appeal.reasonsForAppeal.isEdit&&(e.session.appeal.reasonsForAppeal.isEdit=!1),a.redirect(T.caseBuilding.timeline);if(void 0===e.session.appeal.reasonsForAppeal.evidences){const e=[{href:"uploadFile",text:v.validationErrors.fileUpload.noFileSelected,value:"#uploadFile"}];return a.render("reasons-for-appeal/supporting-evidence-upload-page.njk",{errorList:Object.values(e),error:e})}return await i.submitEvent($.b.EDIT_REASONS_FOR_APPEAL,e),de(e,a,T.reasonsForAppeal.checkAndSend)}catch(e){t(e)}})),a.get(T.reasonsForAppeal.confirmation,$a),a}({updateAppealService:Va,documentManagementService:Ja}),gt=function(e){const a=Object(p.Router)();return a.get(T.reasonsForAppeal.checkAndSend,Ma),a.post(T.reasonsForAppeal.checkAndSend,function(e){return async(a,t,i)=>{try{return le(a.body)?(await e.submitEvent($.b.SUBMIT_REASONS_FOR_APPEAL,a),t.redirect(T.reasonsForAppeal.confirmation)):t.redirect(T.caseBuilding.timeline)}catch(e){i(e)}}}(e)),a}(Va);Qa.use(Xa),Qa.use(at),Qa.use(et),Qa.use(mt),Qa.use(ht),Qa.use(vt),Qa.use(nt),Qa.use(tt),Qa.use(ot),Qa.use(st),Qa.use(lt),Qa.use(rt),Qa.use(ut),Qa.use(pt),Qa.use(ct),Qa.use(dt),Qa.use(it),Qa.use(ft),Qa.use(gt);const yt=t(49),bt=t(50),wt=!0===g.a.get("session.useRedis"),kt=!0===g.a.get("session.cookie.secure");function At(){const e=d()();return function(e){e.use(h()()),e.use(h.a.referrerPolicy({policy:"origin"})),e.use(h.a.contentSecurityPolicy({directives:{defaultSrc:["'self'"],fontSrc:["'self' data:"],scriptSrc:["'self'","'unsafe-inline'","www.google-analytics.com","www.googletagmanager.com","tagmanager.google.com"],styleSrc:["'self'","tagmanager.google.com","fonts.googleapis.com/"],connectSrc:["'self'","www.gov.uk"],mediaSrc:["'self'"],frameSrc:["'self'","www.googletagmanager.com","vcc-eu4.8x8.com"],frameAncestors:["'self'","www.googletagmanager.com"],imgSrc:["'self'","data:","www.google-analytics.com","www.googletagmanager.com","tagmanager.google.com","vcc-eu4.8x8.com"]}})),e.use(h.a.permittedCrossDomainPolicies()),e.use(c()({enforce:!0,maxAge:60})),e.use(h.a.featurePolicy({features:{accelerometer:["'none'"],ambientLightSensor:["'none'"],autoplay:["'none'"],camera:["'none'"],geolocation:["'none'"],gyroscope:["'none'"],magnetometer:["'none'"],microphone:["'none'"],payment:["'none'"],speaker:["'none'"],usb:["'none'"],vibrate:["'none'"]}})),e.use(h.a.noCache())}(e),e.use(function(){if(wt){let e=t(51)(bt);const a={url:g.a.get("session.redis.url"),ttl:g.a.get("session.redis.ttlInSeconds")};let i=yt.createClient(a);return bt({cookie:{httpOnly:!0,maxAge:g.a.get("session.cookie.maxAgeInMs"),secure:kt,sameSite:"lax"},resave:!0,saveUninitialized:!0,secret:g.a.get("session.redis.secret"),rolling:!0,store:new e({client:i})})}return bt({secret:g.a.get("session.redis.secret"),resave:!1,saveUninitialized:!0,cookie:{secure:!1}})}()),function(e){const a=g.a.get("appInsights.instrumentationKey"),t=new E.a(a);e.locals.logger=t}(e),function(e){const a=w.configure(["views",A.a.resolve("node_modules/govuk-frontend/")],{autoescape:!0,express:e,noCache:!0});a.addFilter("eval",(function(e){return w.renderString(e,this.ctx)})),a.addFilter("path",(function(e){return y.get(T,e)}))}(e),function(e){const a=S.a.getInstance();e.locals.s2s=a}(e),e.set("trust proxy",1),e.locals.i18n=v,e.locals.paths=T,e.use(F),e.use(d.a.static("build",{maxAge:315576e5})),e.use(o.a.urlencoded({extended:!0})),e.use(s()()),e.use(l()()),e.post("*",R),e.use((e,a,t)=>{a.locals.csrfToken=e.csrfToken(),a.locals.host=pe(e.protocol,e.hostname,""),t()}),e.use(O),e.use(Qa),e.use(L),e.use(D.a),e.use(D.b),e}t.d(a,"a",(function(){return At}))},function(e,a,t){e.exports=t(36)},function(e,a,t){"use strict";t.r(a),function(e){t(37),t(38);var a=t(34),i=t(10),o=t(7);Object(i.a)();const n=Object(a.a)(),s=process.env.PORT||3e3,r=new o.a,l=Object(o.b)(e);n.listen(s,()=>{r.trace(`Server  listening on port ${s}`,l)}).on("error",e=>{r.exception(`Unable to start server because of ${e.message}`,l)})}.call(this,"/index.js")},function(e,a){e.exports=require("graceful-fs")},function(e,a){e.exports=require("https")},function(e,a){e.exports=require("webpack-merge")},function(e,a,t){(function(a){const i=t(41),o=t(42),n=t(43),s=t(9),r={server:{entry:["./app/server.ts"],target:"node",output:{path:s.resolve(a,"../build"),filename:"[name].js"},resolve:{extensions:[".ts",".js"]},externals:[i()],module:{rules:[{test:/\.ts$/,use:["ts-loader"]}]}},client:{entry:["./client/main.ts","./app/assets/scss/application.scss"],watch:!0,target:"web",output:{path:s.resolve(a,"../build"),filename:"all.js"},resolve:{extensions:[".ts",".js"]},module:{rules:[{test:/\.ts$/,exclude:/node_modules/,use:[{loader:"babel-loader",options:{presets:["@babel/preset-env"]}},{loader:"ts-loader"}]},{test:/\.(sa|sc|c)ss$/,loader:[n.loader,"css-loader","sass-loader"]}]},plugins:[new o([{from:s.resolve("node_modules/govuk-frontend/govuk/assets/"),to:"assets"},{from:s.resolve("app/assets/images/"),to:"assets/images"}]),new n({filename:"[name].css"})]}};e.exports=r}).call(this,"/")},function(e,a){e.exports=require("webpack-node-externals")},function(e,a){e.exports=require("copy-webpack-plugin")},function(e,a){e.exports=require("mini-css-extract-plugin")},function(e,a){e.exports=require("otp")},function(e,a){e.exports=require("dompurify")},function(e,a){e.exports=require("jsdom")},function(e,a,t){const i=t(18).PhoneNumberFormat,o=t(18).PhoneNumberType,n=t(18).PhoneNumberUtil.getInstance();e.exports=e=>({base:e.string(),type:"mobilePhoneNumber",messages:{"string.mobilePhoneNumber.invalid.string":'"{{#label}}" did not seem to be a valid phone number',"string.mobilePhoneNumber.invalid.mobile":'"{{#label}}" did not seem to be a valid mobile phone number'},rules:{defaultCountry:{alias:"defaultCountries",method(e){return this.$_setFlag("defaultCountry",e)}},format:{method(e){return this.$_setFlag("format",e)}}},validate(e,{schema:a,error:t}){const s={e164:i.E164,international:i.INTERNATIONAL,national:i.NATIONAL,rfc3966:i.RFC3966},r="GB",l="e164",u=a.$_getFlag("defaultCountry")||r,c=a.$_getFlag("format")||l;try{const a=s[c];if(void 0===a)throw new Error("Invalid format value: must be one of [e164, international, national, rfc3966]");const t=n.parse(e,u);if(!n.isValidNumber(t))throw new Error("The string supplied did not seem to be a phone number");if(n.getNumberType(t)!==o.MOBILE)throw new Error("The phone supplied did not seem to be a valid mobile phone number");return{value:n.format(t,a)}}catch(a){const i=[];if([{error:"string.mobilePhoneNumber.invalid.string",errorMessages:["The string supplied did not seem to be a phone number","Phone number too short after IDD"]},{error:"string.mobilePhoneNumber.invalid.mobile",errorMessages:["The phone supplied did not seem to be a valid mobile phone number"]}].forEach(e=>{e.errorMessages.includes(a.message)&&i.push(t(e.error))}),i.length)return{value:e,errors:i};throw a}}})},function(e,a){e.exports=require("multer")},function(e,a){e.exports=require("redis")},function(e,a){e.exports=require("express-session")},function(e,a){e.exports=require("connect-redis")}]);